<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.tk.oms.analysis.dao.OperationAnalysisDao">
	
	<!-- 实时概况：支付买家数、支付订单数 -->
	<select id="queryRealTimeDetail_custom_order_Count" parameterType="java.util.Map" resultType="java.util.Map">
		select count(*) custom_count,nvl(sum(order_count), 0) order_count from (
		    select user_name,count(*) order_count from tbl_order_info t where PAYMENT_state = 2
		    and PAYMENT_DATE >= to_date(#{start_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
		    and PAYMENT_DATE &lt;= to_date(#{end_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
		    <if test="site_id !=null and site_id !=0">
		 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = t.user_name)
		 	</if>
		 	<if test="public_user_type != 1">
		 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = t.user_name)
		 	</if>
		    group by user_name
		)
	</select>
	
	<!-- 实时概况：访客数,浏览量 -->
	<select id="queryRealTimeDetail_visitor_pv_Count" parameterType="java.util.Map" resultType="java.util.Map">
		select count(*) visitor_count,nvl(sum(pv_count),0) pv_count from (
		    select create_user_name,count(*) pv_count from tbl_user_log_info b
		    where 
		     b.create_date >= to_date(#{start_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
		    and b.create_date &lt;= to_date(#{end_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
		    <if test="site_id !=null and site_id !=0">
		 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = b.create_user_name)
		 	</if>
		 	<if test="public_user_type != 1">
		 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = b.create_user_name)
		 	</if>
		    group by create_user_name
		)
	</select>
	
	<!-- 实时概况：所有支付金额 -->
  	<select id="queryRealTimeDetail_AllPayMoney_Chart" parameterType="java.util.Map" resultType="java.util.Map">
  		select to_char(PAYMENT_DATE,'hh24')||':00' TIME_DATE,nvl(sum(PRODUCT_money+df_money+LOGISTICS_MONEY),0) CNT from TBL_ORDER_INFO b
		where b.PAYMENT_STATE = 2
		and b.PAYMENT_DATE >= to_date(#{start_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
		and b.PAYMENT_DATE &lt;= to_date(#{end_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
		<if test="site_id !=null and site_id !=0">
			and exists
			(
			    select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = b.user_name
			)
		</if>
		<if test="public_user_type != 1">
	 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = b.user_name)
	 	</if>
	 	group by to_char(PAYMENT_DATE,'hh24')
  	</select>
  	
  	<!-- 实时概况：预订支付的首款 -->
  	<select id="queryRealTimeDetail_PreFirstMoney_Chart" parameterType="java.util.Map" resultType="java.util.Map">
  		select to_char(PAYMENT_DATE,'hh24')||':00' TIME_DATE,sum(b.EARNEST_MONEY) CNT from TBL_PRE_ORDER_INFO b
		where b.PAYMENT_STATE = 2
		and b.PAYMENT_DATE >= to_date(#{start_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
		and b.PAYMENT_DATE &lt;= to_date(#{end_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
		<if test="site_id !=null and site_id !=0">
			and exists
			(
			    select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = b.user_id
			)
		</if>
		<if test="public_user_type != 1">
	 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = b.user_id)
	 	</if>
	 	group by to_char(PAYMENT_DATE,'hh24')
  	</select>
  	
  	<!-- 实时概况：尾款订单的定金金额 -->
  	<select id="queryRealTimeDetail_PreOrderFirstMoney_Chart" parameterType="java.util.Map" resultType="java.util.Map">
  		select to_char(b.PAYMENT_DATE,'hh24')||':00' TIME_DATE,sum(f.EARNEST_MONEY) CNT from TBL_ORDER_INFO b,TBL_PRE_ORDER_RELATE f
		where b.order_number = f.order_number 
		and b.PAYMENT_STATE = 2
		and b.PAYMENT_DATE >= to_date(#{start_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
		and b.PAYMENT_DATE &lt;= to_date(#{end_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
		<if test="site_id !=null and site_id !=0">
			and exists
			(
			    select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = b.user_name
			)
		</if>
		<if test="public_user_type != 1">
	 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = b.user_name)
	 	</if>
	 	group by to_char(b.PAYMENT_DATE,'hh24')
  	</select>

	<!-- 1:废弃 -->
	<select id="queryRealTimeDetailTD" parameterType="java.util.Map" resultType="java.util.Map">
		select td_pv,td_visitor_count,
				(select count(1) from tbl_order_info t where create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 00:00:00','yyyy-mm-dd hh24:mi:ss')
				 and create_date &lt;= to_date(to_char(sysdate,'yyyy-mm-dd')||' 23:59:59','yyyy-mm-dd hh24:mi:ss') and order_state in (2,3,5)
				 <choose>
				 	<when test="site_id !=null and site_id !=0">
				 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = t.user_name)
				 	</when>
				 	<when test="public_user_type != 1">
				 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = t.user_name)
				 	</when>
				 	<otherwise></otherwise>
				 </choose>
				 ) td_order_count,
				 (select count(1) from (select user_name from tbl_order_info t where create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 00:00:00','yyyy-mm-dd hh24:mi:ss')
				 and create_date &lt;= to_date(to_char(sysdate,'yyyy-mm-dd')||' 23:59:59','yyyy-mm-dd hh24:mi:ss') and order_state in (2,3,5)
				 <choose>
				 	<when test="site_id !=null and site_id !=0">
				 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = t.user_name)
				 	</when>
				 	<when test="public_user_type != 1">
				 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = t.user_name)
				 	</when>
				 	<otherwise></otherwise>
				 </choose>
				 group by user_name)) td_custom_count,
				 (select nvl(sum(payment_money),0) from tbl_order_info t where create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 00:00:00','yyyy-mm-dd hh24:mi:ss')
				 and create_date &lt;= to_date(to_char(sysdate,'yyyy-mm-dd')||' 23:59:59','yyyy-mm-dd hh24:mi:ss') and order_state in (2,3,5)
				 <choose>
				 	<when test="site_id !=null and site_id !=0">
				 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = t.user_name)
				 	</when>
				 	<when test="public_user_type != 1">
				 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = t.user_name)
				 	</when>
				 	<otherwise></otherwise>
				 </choose>
				 ) td_payment_money,
				 (select nvl(sum(product_count),0) from tbl_order_info t where order_state in (2,3,5)
				   and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 00:00:00','yyyy-mm-dd hh24:mi:ss')
				   and create_date &lt;= to_date(to_char(sysdate,'yyyy-mm-dd')||' 23:59:59','yyyy-mm-dd hh24:mi:ss')
				   <choose>
				 	<when test="site_id !=null and site_id !=0">
				 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = t.user_name)
				 	</when>
				 	<when test="public_user_type != 1">
				 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = t.user_name)
				 	</when>
				 	<otherwise></otherwise>
				 </choose>
			      ) td_product_count
			from (
			select  nvl(sum (temp.pv),0) td_pv,
			        count (create_user_name) td_visitor_count
			from (select
			    create_user_name,
			    count (1) pv
			from tbl_user_log_info t
			where create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 00:00:00','yyyy-mm-dd hh24:mi:ss')
			 and create_date &lt;= to_date(to_char(sysdate,'yyyy-mm-dd')||' 23:59:59','yyyy-mm-dd hh24:mi:ss')
		     <choose>
				 	<when test="site_id !=null and site_id !=0">
				 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = t.create_user_name)
				 	</when>
				 	<when test="public_user_type != 1">
				 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = t.create_user_name)
				 	</when>
				 	<otherwise></otherwise>
				 </choose>
			group by create_user_name) temp)
	</select>
	<!-- 2：废弃 -->
	<select id="queryRealTimeDetailYD" parameterType="java.util.Map" resultType="java.util.Map">
		select yd_pv,yd_visitor_count,
				(select count(1) from tbl_order_info t where create_date >= to_date(to_char(sysdate-1,'yyyy-mm-dd')||' 00:00:00','yyyy-mm-dd hh24:mi:ss')
				 and create_date &lt;= to_date(to_char(sysdate-1,'yyyy-mm-dd')||' 23:59:59','yyyy-mm-dd hh24:mi:ss') and order_state in (2,3,5)
			     <choose>
				 	<when test="site_id !=null and site_id !=0">
				 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = t.user_name)
				 	</when>
				 	<when test="public_user_type != 1">
				 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = t.user_name)
				 	</when>
				 	<otherwise></otherwise>
				 </choose>
				 ) yd_order_count,
				 (select count(1) from (select user_name from tbl_order_info t where create_date >= to_date(to_char(sysdate-1,'yyyy-mm-dd')||' 00:00:00','yyyy-mm-dd hh24:mi:ss')
				 and create_date &lt;= to_date(to_char(sysdate-1,'yyyy-mm-dd')||' 23:59:59','yyyy-mm-dd hh24:mi:ss') and order_state in (2,3,5)
				 <choose>
				 	<when test="site_id !=null and site_id !=0">
				 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = t.user_name)
				 	</when>
				 	<when test="public_user_type != 1">
				 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = t.user_name)
				 	</when>
				 	<otherwise></otherwise>
				 </choose>
				  group by user_name)) yd_custom_count,
				 (select nvl(sum(payment_money),0) from tbl_order_info t where create_date >= to_date(to_char(sysdate-1,'yyyy-mm-dd')||' 00:00:00','yyyy-mm-dd hh24:mi:ss')
				 and create_date &lt;= to_date(to_char(sysdate-1,'yyyy-mm-dd')||' 23:59:59','yyyy-mm-dd hh24:mi:ss') and order_state in (2,3,5)
				 <choose>
				 	<when test="site_id !=null and site_id !=0">
				 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = t.user_name)
				 	</when>
				 	<when test="public_user_type != 1">
				 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = t.user_name)
				 	</when>
				 	<otherwise></otherwise>
				 </choose>
				 ) yd_payment_money,
				 (select nvl(sum(product_count),0) from tbl_order_info t where order_state in (2,3,5)
				   and create_date >= to_date(to_char(sysdate-1,'yyyy-mm-dd')||' 00:00:00','yyyy-mm-dd hh24:mi:ss')
				   and create_date &lt;= to_date(to_char(sysdate-1,'yyyy-mm-dd')||' 23:59:59','yyyy-mm-dd hh24:mi:ss')
				   <choose>
				 	<when test="site_id !=null and site_id !=0">
				 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = t.user_name)
				 	</when>
				 	<when test="public_user_type != 1">
				 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = t.user_name)
				 	</when>
				 	<otherwise></otherwise>
				 </choose>
			      ) yd_product_count
			from (
			select nvl(sum (temp.pv),0) yd_pv,
			       count (create_user_name) yd_visitor_count
			from (select
			    create_user_name,
			    count (1) pv
			from tbl_user_log_info t
			where create_date >= to_date(to_char(sysdate-1,'yyyy-mm-dd')||' 00:00:00','yyyy-mm-dd hh24:mi:ss')
			 and create_date &lt;= to_date(to_char(sysdate-1,'yyyy-mm-dd')||' 23:59:59','yyyy-mm-dd hh24:mi:ss')
		     <choose>
				 	<when test="site_id !=null and site_id !=0">
				 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = t.create_user_name)
				 	</when>
				 	<when test="public_user_type != 1">
				 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = t.create_user_name)
				 	</when>
				 	<otherwise></otherwise>
				 </choose>
			group by create_user_name) temp)
	</select>
	<!-- 3：废弃 -->
	<select id="queryRealTimeLineTD" parameterType="java.util.Map" resultType="java.util.Map">
		 select nvl(sum(payment_money),0) payment_money from tbl_order_info t where create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 00:00:00','yyyy-mm-dd hh24:mi:ss')
		 and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 01:00:00','yyyy-mm-dd hh24:mi:ss')  and order_state in (2,3,5)
		 <choose>
		 	<when test="site_id !=null and site_id !=0">
		 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = t.user_name)
		 	</when>
		 	<when test="public_user_type != 1">
		 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = t.user_name)
		 	</when>
		 	<otherwise></otherwise>
		 </choose>
		 union all
		 select nvl(sum(payment_money),0) payment_money from tbl_order_info t where create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 01:00:00','yyyy-mm-dd hh24:mi:ss')
		 and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 02:00:00','yyyy-mm-dd hh24:mi:ss')  and order_state in (2,3,5)
		 <choose>
		 	<when test="site_id !=null and site_id !=0">
		 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = t.user_name)
		 	</when>
		 	<when test="public_user_type != 1">
		 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = t.user_name)
		 	</when>
		 	<otherwise></otherwise>
		 </choose>
		 union all
		 select nvl(sum(payment_money),0) payment_money from tbl_order_info t where create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 02:00:00','yyyy-mm-dd hh24:mi:ss')
		 and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 03:00:00','yyyy-mm-dd hh24:mi:ss')  and order_state in (2,3,5)
		 <choose>
		 	<when test="site_id !=null and site_id !=0">
		 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = t.user_name)
		 	</when>
		 	<when test="public_user_type != 1">
		 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = t.user_name)
		 	</when>
		 	<otherwise></otherwise>
		 </choose>
		 union all
		 select nvl(sum(payment_money),0) payment_money from tbl_order_info t where create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 03:00:00','yyyy-mm-dd hh24:mi:ss')
		 and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 04:00:00','yyyy-mm-dd hh24:mi:ss')  and order_state in (2,3,5)
		 <choose>
		 	<when test="site_id !=null and site_id !=0">
		 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = t.user_name)
		 	</when>
		 	<when test="public_user_type != 1">
		 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = t.user_name)
		 	</when>
		 	<otherwise></otherwise>
		 </choose>
		 union all
		 select nvl(sum(payment_money),0) payment_money from tbl_order_info t where create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 04:00:00','yyyy-mm-dd hh24:mi:ss')
		 and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 05:00:00','yyyy-mm-dd hh24:mi:ss')  and order_state in (2,3,5)
		 <choose>
		 	<when test="site_id !=null and site_id !=0">
		 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = t.user_name)
		 	</when>
		 	<when test="public_user_type != 1">
		 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = t.user_name)
		 	</when>
		 	<otherwise></otherwise>
		 </choose>
		 union all
		 select nvl(sum(payment_money),0) payment_money from tbl_order_info t where create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 05:00:00','yyyy-mm-dd hh24:mi:ss')
		 and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 06:00:00','yyyy-mm-dd hh24:mi:ss')  and order_state in (2,3,5)
		 <choose>
		 	<when test="site_id !=null and site_id !=0">
		 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = t.user_name)
		 	</when>
		 	<when test="public_user_type != 1">
		 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = t.user_name)
		 	</when>
		 	<otherwise></otherwise>
		 </choose>
		 union all
		 select nvl(sum(payment_money),0) payment_money from tbl_order_info t where create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 06:00:00','yyyy-mm-dd hh24:mi:ss')
		 and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 07:00:00','yyyy-mm-dd hh24:mi:ss')  and order_state in (2,3,5)
		 <choose>
		 	<when test="site_id !=null and site_id !=0">
		 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = t.user_name)
		 	</when>
		 	<when test="public_user_type != 1">
		 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = t.user_name)
		 	</when>
		 	<otherwise></otherwise>
		 </choose>
		 union all
		 select nvl(sum(payment_money),0) payment_money from tbl_order_info t where create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 07:00:00','yyyy-mm-dd hh24:mi:ss')
		 and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 08:00:00','yyyy-mm-dd hh24:mi:ss')  and order_state in (2,3,5)
		 <choose>
		 	<when test="site_id !=null and site_id !=0">
		 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = t.user_name)
		 	</when>
		 	<when test="public_user_type != 1">
		 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = t.user_name)
		 	</when>
		 	<otherwise></otherwise>
		 </choose>
		 union all
		 select nvl(sum(payment_money),0) payment_money from tbl_order_info t where create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 08:00:00','yyyy-mm-dd hh24:mi:ss')
		 and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 09:00:00','yyyy-mm-dd hh24:mi:ss')  and order_state in (2,3,5)
		 <choose>
		 	<when test="site_id !=null and site_id !=0">
		 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = t.user_name)
		 	</when>
		 	<when test="public_user_type != 1">
		 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = t.user_name)
		 	</when>
		 	<otherwise></otherwise>
		 </choose>
		 union all
		 select nvl(sum(payment_money),0) payment_money from tbl_order_info t where create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 09:00:00','yyyy-mm-dd hh24:mi:ss')
		 and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 10:00:00','yyyy-mm-dd hh24:mi:ss')  and order_state in (2,3,5)
		 <choose>
		 	<when test="site_id !=null and site_id !=0">
		 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = t.user_name)
		 	</when>
		 	<when test="public_user_type != 1">
		 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = t.user_name)
		 	</when>
		 	<otherwise></otherwise>
		 </choose>
		 union all
		 select nvl(sum(payment_money),0) payment_money from tbl_order_info t where create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 10:00:00','yyyy-mm-dd hh24:mi:ss')
		 and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 11:00:00','yyyy-mm-dd hh24:mi:ss')  and order_state in (2,3,5)
		 <choose>
		 	<when test="site_id !=null and site_id !=0">
		 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = t.user_name)
		 	</when>
		 	<when test="public_user_type != 1">
		 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = t.user_name)
		 	</when>
		 	<otherwise></otherwise>
		 </choose>
		 union all
		 select nvl(sum(payment_money),0) payment_money from tbl_order_info t where create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 11:00:00','yyyy-mm-dd hh24:mi:ss')
		 and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 12:00:00','yyyy-mm-dd hh24:mi:ss')  and order_state in (2,3,5)
		 <choose>
		 	<when test="site_id !=null and site_id !=0">
		 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = t.user_name)
		 	</when>
		 	<when test="public_user_type != 1">
		 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = t.user_name)
		 	</when>
		 	<otherwise></otherwise>
		 </choose>
		 union all
		 select nvl(sum(payment_money),0) payment_money from tbl_order_info t where create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 12:00:00','yyyy-mm-dd hh24:mi:ss')
		 and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 13:00:00','yyyy-mm-dd hh24:mi:ss')  and order_state in (2,3,5)
		 <choose>
		 	<when test="site_id !=null and site_id !=0">
		 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = t.user_name)
		 	</when>
		 	<when test="public_user_type != 1">
		 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = t.user_name)
		 	</when>
		 	<otherwise></otherwise>
		 </choose>
		 union all
		 select nvl(sum(payment_money),0) payment_money from tbl_order_info t where create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 13:00:00','yyyy-mm-dd hh24:mi:ss')
		 and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 14:00:00','yyyy-mm-dd hh24:mi:ss')  and order_state in (2,3,5)
		 <choose>
		 	<when test="site_id !=null and site_id !=0">
		 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = t.user_name)
		 	</when>
		 	<when test="public_user_type != 1">
		 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = t.user_name)
		 	</when>
		 	<otherwise></otherwise>
		 </choose>
		 union all
		 select nvl(sum(payment_money),0) payment_money from tbl_order_info t where create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 14:00:00','yyyy-mm-dd hh24:mi:ss')
		 and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 15:00:00','yyyy-mm-dd hh24:mi:ss')  and order_state in (2,3,5)
		 <choose>
		 	<when test="site_id !=null and site_id !=0">
		 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = t.user_name)
		 	</when>
		 	<when test="public_user_type != 1">
		 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = t.user_name)
		 	</when>
		 	<otherwise></otherwise>
		 </choose>
		 union all
		 select nvl(sum(payment_money),0) payment_money from tbl_order_info t where create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 15:00:00','yyyy-mm-dd hh24:mi:ss')
		 and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 16:00:00','yyyy-mm-dd hh24:mi:ss')  and order_state in (2,3,5)
		 <choose>
		 	<when test="site_id !=null and site_id !=0">
		 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = t.user_name)
		 	</when>
		 	<when test="public_user_type != 1">
		 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = t.user_name)
		 	</when>
		 	<otherwise></otherwise>
		 </choose>
		 union all
		 select nvl(sum(payment_money),0) payment_money from tbl_order_info t where create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 16:00:00','yyyy-mm-dd hh24:mi:ss')
		 and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 17:00:00','yyyy-mm-dd hh24:mi:ss')  and order_state in (2,3,5)
		 <choose>
		 	<when test="site_id !=null and site_id !=0">
		 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = t.user_name)
		 	</when>
		 	<when test="public_user_type != 1">
		 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = t.user_name)
		 	</when>
		 	<otherwise></otherwise>
		 </choose>
		 union all
		 select nvl(sum(payment_money),0) payment_money from tbl_order_info t where create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 17:00:00','yyyy-mm-dd hh24:mi:ss')
		 and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 18:00:00','yyyy-mm-dd hh24:mi:ss')  and order_state in (2,3,5)
		 <choose>
		 	<when test="site_id !=null and site_id !=0">
		 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = t.user_name)
		 	</when>
		 	<when test="public_user_type != 1">
		 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = t.user_name)
		 	</when>
		 	<otherwise></otherwise>
		 </choose>
		 union all
		 select nvl(sum(payment_money),0) payment_money from tbl_order_info t where create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 18:00:00','yyyy-mm-dd hh24:mi:ss')
		 and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 19:00:00','yyyy-mm-dd hh24:mi:ss')  and order_state in (2,3,5)
		 <choose>
		 	<when test="site_id !=null and site_id !=0">
		 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = t.user_name)
		 	</when>
		 	<when test="public_user_type != 1">
		 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = t.user_name)
		 	</when>
		 	<otherwise></otherwise>
		 </choose>
		 union all
		 select nvl(sum(payment_money),0) payment_money from tbl_order_info t where create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 19:00:00','yyyy-mm-dd hh24:mi:ss')
		 and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 20:00:00','yyyy-mm-dd hh24:mi:ss')  and order_state in (2,3,5)
		 <choose>
		 	<when test="site_id !=null and site_id !=0">
		 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = t.user_name)
		 	</when>
		 	<when test="public_user_type != 1">
		 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = t.user_name)
		 	</when>
		 	<otherwise></otherwise>
		 </choose>
		 union all
		 select nvl(sum(payment_money),0) payment_money from tbl_order_info t where create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 20:00:00','yyyy-mm-dd hh24:mi:ss')
		 and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 21:00:00','yyyy-mm-dd hh24:mi:ss')  and order_state in (2,3,5)
		 <choose>
		 	<when test="site_id !=null and site_id !=0">
		 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = t.user_name)
		 	</when>
		 	<when test="public_user_type != 1">
		 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = t.user_name)
		 	</when>
		 	<otherwise></otherwise>
		 </choose>
		 union all
		 select nvl(sum(payment_money),0) payment_money from tbl_order_info t where create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 21:00:00','yyyy-mm-dd hh24:mi:ss')
		 and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 22:00:00','yyyy-mm-dd hh24:mi:ss')  and order_state in (2,3,5)
		 <choose>
		 	<when test="site_id !=null and site_id !=0">
		 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = t.user_name)
		 	</when>
		 	<when test="public_user_type != 1">
		 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = t.user_name)
		 	</when>
		 	<otherwise></otherwise>
		 </choose>
		 union all
		 select nvl(sum(payment_money),0) payment_money from tbl_order_info t where create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 22:00:00','yyyy-mm-dd hh24:mi:ss')
		 and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 23:00:00','yyyy-mm-dd hh24:mi:ss')  and order_state in (2,3,5)
		 <choose>
		 	<when test="site_id !=null and site_id !=0">
		 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = t.user_name)
		 	</when>
		 	<when test="public_user_type != 1">
		 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = t.user_name)
		 	</when>
		 	<otherwise></otherwise>
		 </choose>
		 union all
		 select nvl(sum(payment_money),0) payment_money from tbl_order_info t where create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 23:00:00','yyyy-mm-dd hh24:mi:ss')
		 and create_date &lt;= to_date(to_char(sysdate,'yyyy-mm-dd')||' 23:59:59','yyyy-mm-dd hh24:mi:ss')  and order_state in (2,3,5)
		 <choose>
		 	<when test="site_id !=null and site_id !=0">
		 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = t.user_name)
		 	</when>
		 	<when test="public_user_type != 1">
		 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = t.user_name)
		 	</when>
		 	<otherwise></otherwise>
		 </choose>
	</select>
	<!-- 4：废弃 -->
	<select id="queryRealTimeLineYD" parameterType="java.util.Map" resultType="java.util.Map">
		 select nvl(sum(payment_money),0) payment_money from tbl_order_info t where create_date >= to_date(to_char(sysdate-1,'yyyy-mm-dd')||' 00:00:00','yyyy-mm-dd hh24:mi:ss')
		 and create_date &lt; to_date(to_char(sysdate-1,'yyyy-mm-dd')||' 01:00:00','yyyy-mm-dd hh24:mi:ss')  and order_state in (2,3,5)
		 <choose>
		 	<when test="site_id !=null and site_id !=0">
		 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = t.user_name)
		 	</when>
		 	<when test="public_user_type != 1">
		 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = t.user_name)
		 	</when>
		 	<otherwise></otherwise>
		 </choose>
		 union all
		 select nvl(sum(payment_money),0) payment_money from tbl_order_info t where create_date >= to_date(to_char(sysdate-1,'yyyy-mm-dd')||' 01:00:00','yyyy-mm-dd hh24:mi:ss')
		 and create_date &lt; to_date(to_char(sysdate-1,'yyyy-mm-dd')||' 02:00:00','yyyy-mm-dd hh24:mi:ss')  and order_state in (2,3,5)
		 <choose>
		 	<when test="site_id !=null and site_id !=0">
		 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = t.user_name)
		 	</when>
		 	<when test="public_user_type != 1">
		 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = t.user_name)
		 	</when>
		 	<otherwise></otherwise>
		 </choose>
		 union all
		 select nvl(sum(payment_money),0) payment_money from tbl_order_info t where create_date >= to_date(to_char(sysdate-1,'yyyy-mm-dd')||' 02:00:00','yyyy-mm-dd hh24:mi:ss')
		 and create_date &lt; to_date(to_char(sysdate-1,'yyyy-mm-dd')||' 03:00:00','yyyy-mm-dd hh24:mi:ss')  and order_state in (2,3,5)
		 <choose>
		 	<when test="site_id !=null and site_id !=0">
		 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = t.user_name)
		 	</when>
		 	<when test="public_user_type != 1">
		 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = t.user_name)
		 	</when>
		 	<otherwise></otherwise>
		 </choose>
		 union all
		 select nvl(sum(payment_money),0) payment_money from tbl_order_info t where create_date >= to_date(to_char(sysdate-1,'yyyy-mm-dd')||' 03:00:00','yyyy-mm-dd hh24:mi:ss')
		 and create_date &lt; to_date(to_char(sysdate-1,'yyyy-mm-dd')||' 04:00:00','yyyy-mm-dd hh24:mi:ss')  and order_state in (2,3,5)
		 <choose>
		 	<when test="site_id !=null and site_id !=0">
		 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = t.user_name)
		 	</when>
		 	<when test="public_user_type != 1">
		 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = t.user_name)
		 	</when>
		 	<otherwise></otherwise>
		 </choose>
		 union all
		 select nvl(sum(payment_money),0) payment_money from tbl_order_info t where create_date >= to_date(to_char(sysdate-1,'yyyy-mm-dd')||' 04:00:00','yyyy-mm-dd hh24:mi:ss')
		 and create_date &lt; to_date(to_char(sysdate-1,'yyyy-mm-dd')||' 05:00:00','yyyy-mm-dd hh24:mi:ss')  and order_state in (2,3,5)
		 <choose>
		 	<when test="site_id !=null and site_id !=0">
		 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = t.user_name)
		 	</when>
		 	<when test="public_user_type != 1">
		 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = t.user_name)
		 	</when>
		 	<otherwise></otherwise>
		 </choose>
		 union all
		 select nvl(sum(payment_money),0) payment_money from tbl_order_info t where create_date >= to_date(to_char(sysdate-1,'yyyy-mm-dd')||' 05:00:00','yyyy-mm-dd hh24:mi:ss')
		 and create_date &lt; to_date(to_char(sysdate-1,'yyyy-mm-dd')||' 06:00:00','yyyy-mm-dd hh24:mi:ss')  and order_state in (2,3,5)
		 <choose>
		 	<when test="site_id !=null and site_id !=0">
		 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = t.user_name)
		 	</when>
		 	<when test="public_user_type != 1">
		 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = t.user_name)
		 	</when>
		 	<otherwise></otherwise>
		 </choose>
		 union all
		 select nvl(sum(payment_money),0) payment_money from tbl_order_info t where create_date >= to_date(to_char(sysdate-1,'yyyy-mm-dd')||' 06:00:00','yyyy-mm-dd hh24:mi:ss')
		 and create_date &lt; to_date(to_char(sysdate-1,'yyyy-mm-dd')||' 07:00:00','yyyy-mm-dd hh24:mi:ss')  and order_state in (2,3,5)
		 <choose>
		 	<when test="site_id !=null and site_id !=0">
		 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = t.user_name)
		 	</when>
		 	<when test="public_user_type != 1">
		 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = t.user_name)
		 	</when>
		 	<otherwise></otherwise>
		 </choose>
		 union all
		 select nvl(sum(payment_money),0) payment_money from tbl_order_info t where create_date >= to_date(to_char(sysdate-1,'yyyy-mm-dd')||' 07:00:00','yyyy-mm-dd hh24:mi:ss')
		 and create_date &lt; to_date(to_char(sysdate-1,'yyyy-mm-dd')||' 08:00:00','yyyy-mm-dd hh24:mi:ss')  and order_state in (2,3,5)
		 <choose>
		 	<when test="site_id !=null and site_id !=0">
		 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = t.user_name)
		 	</when>
		 	<when test="public_user_type != 1">
		 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = t.user_name)
		 	</when>
		 	<otherwise></otherwise>
		 </choose>
		 union all
		 select nvl(sum(payment_money),0) payment_money from tbl_order_info t where create_date >= to_date(to_char(sysdate-1,'yyyy-mm-dd')||' 08:00:00','yyyy-mm-dd hh24:mi:ss')
		 and create_date &lt; to_date(to_char(sysdate-1,'yyyy-mm-dd')||' 09:00:00','yyyy-mm-dd hh24:mi:ss')  and order_state in (2,3,5)
		 <choose>
		 	<when test="site_id !=null and site_id !=0">
		 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = t.user_name)
		 	</when>
		 	<when test="public_user_type != 1">
		 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = t.user_name)
		 	</when>
		 	<otherwise></otherwise>
		 </choose>
		 union all
		 select nvl(sum(payment_money),0) payment_money from tbl_order_info t where create_date >= to_date(to_char(sysdate-1,'yyyy-mm-dd')||' 09:00:00','yyyy-mm-dd hh24:mi:ss')
		 and create_date &lt; to_date(to_char(sysdate-1,'yyyy-mm-dd')||' 10:00:00','yyyy-mm-dd hh24:mi:ss')  and order_state in (2,3,5)
		 <choose>
		 	<when test="site_id !=null and site_id !=0">
		 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = t.user_name)
		 	</when>
		 	<when test="public_user_type != 1">
		 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = t.user_name)
		 	</when>
		 	<otherwise></otherwise>
		 </choose>
		 union all
		 select nvl(sum(payment_money),0) payment_money from tbl_order_info t where create_date >= to_date(to_char(sysdate-1,'yyyy-mm-dd')||' 10:00:00','yyyy-mm-dd hh24:mi:ss')
		 and create_date &lt; to_date(to_char(sysdate-1,'yyyy-mm-dd')||' 11:00:00','yyyy-mm-dd hh24:mi:ss')  and order_state in (2,3,5)
		 <choose>
		 	<when test="site_id !=null and site_id !=0">
		 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = t.user_name)
		 	</when>
		 	<when test="public_user_type != 1">
		 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = t.user_name)
		 	</when>
		 	<otherwise></otherwise>
		 </choose>
		 union all
		 select nvl(sum(payment_money),0) payment_money from tbl_order_info t where create_date >= to_date(to_char(sysdate-1,'yyyy-mm-dd')||' 11:00:00','yyyy-mm-dd hh24:mi:ss')
		 and create_date &lt; to_date(to_char(sysdate-1,'yyyy-mm-dd')||' 12:00:00','yyyy-mm-dd hh24:mi:ss')  and order_state in (2,3,5)
		 <choose>
		 	<when test="site_id !=null and site_id !=0">
		 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = t.user_name)
		 	</when>
		 	<when test="public_user_type != 1">
		 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = t.user_name)
		 	</when>
		 	<otherwise></otherwise>
		 </choose>
		 union all
		 select nvl(sum(payment_money),0) payment_money from tbl_order_info t where create_date >= to_date(to_char(sysdate-1,'yyyy-mm-dd')||' 12:00:00','yyyy-mm-dd hh24:mi:ss')
		 and create_date &lt; to_date(to_char(sysdate-1,'yyyy-mm-dd')||' 13:00:00','yyyy-mm-dd hh24:mi:ss')  and order_state in (2,3,5)
		 <choose>
		 	<when test="site_id !=null and site_id !=0">
		 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = t.user_name)
		 	</when>
		 	<when test="public_user_type != 1">
		 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = t.user_name)
		 	</when>
		 	<otherwise></otherwise>
		 </choose>
		 union all
		 select nvl(sum(payment_money),0) payment_money from tbl_order_info t where create_date >= to_date(to_char(sysdate-1,'yyyy-mm-dd')||' 13:00:00','yyyy-mm-dd hh24:mi:ss')
		 and create_date &lt; to_date(to_char(sysdate-1,'yyyy-mm-dd')||' 14:00:00','yyyy-mm-dd hh24:mi:ss')  and order_state in (2,3,5)
		 <choose>
		 	<when test="site_id !=null and site_id !=0">
		 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = t.user_name)
		 	</when>
		 	<when test="public_user_type != 1">
		 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = t.user_name)
		 	</when>
		 	<otherwise></otherwise>
		 </choose>
		 union all
		 select nvl(sum(payment_money),0) payment_money from tbl_order_info t where create_date >= to_date(to_char(sysdate-1,'yyyy-mm-dd')||' 14:00:00','yyyy-mm-dd hh24:mi:ss')
		 and create_date &lt; to_date(to_char(sysdate-1,'yyyy-mm-dd')||' 15:00:00','yyyy-mm-dd hh24:mi:ss')  and order_state in (2,3,5)
		 <choose>
		 	<when test="site_id !=null and site_id !=0">
		 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = t.user_name)
		 	</when>
		 	<when test="public_user_type != 1">
		 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = t.user_name)
		 	</when>
		 	<otherwise></otherwise>
		 </choose>
		 union all
		 select nvl(sum(payment_money),0) payment_money from tbl_order_info t where create_date >= to_date(to_char(sysdate-1,'yyyy-mm-dd')||' 15:00:00','yyyy-mm-dd hh24:mi:ss')
		 and create_date &lt; to_date(to_char(sysdate-1,'yyyy-mm-dd')||' 16:00:00','yyyy-mm-dd hh24:mi:ss')  and order_state in (2,3,5)
		 <choose>
		 	<when test="site_id !=null and site_id !=0">
		 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = t.user_name)
		 	</when>
		 	<when test="public_user_type != 1">
		 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = t.user_name)
		 	</when>
		 	<otherwise></otherwise>
		 </choose>
		 union all
		 select nvl(sum(payment_money),0) payment_money from tbl_order_info t where create_date >= to_date(to_char(sysdate-1,'yyyy-mm-dd')||' 16:00:00','yyyy-mm-dd hh24:mi:ss')
		 and create_date &lt; to_date(to_char(sysdate-1,'yyyy-mm-dd')||' 17:00:00','yyyy-mm-dd hh24:mi:ss')  and order_state in (2,3,5)
		 <choose>
		 	<when test="site_id !=null and site_id !=0">
		 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = t.user_name)
		 	</when>
		 	<when test="public_user_type != 1">
		 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = t.user_name)
		 	</when>
		 	<otherwise></otherwise>
		 </choose>
		 union all
		 select nvl(sum(payment_money),0) payment_money from tbl_order_info t where create_date >= to_date(to_char(sysdate-1,'yyyy-mm-dd')||' 17:00:00','yyyy-mm-dd hh24:mi:ss')
		 and create_date &lt; to_date(to_char(sysdate-1,'yyyy-mm-dd')||' 18:00:00','yyyy-mm-dd hh24:mi:ss')  and order_state in (2,3,5)
		 <choose>
		 	<when test="site_id !=null and site_id !=0">
		 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = t.user_name)
		 	</when>
		 	<when test="public_user_type != 1">
		 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = t.user_name)
		 	</when>
		 	<otherwise></otherwise>
		 </choose>
		 union all
		 select nvl(sum(payment_money),0) payment_money from tbl_order_info t where create_date >= to_date(to_char(sysdate-1,'yyyy-mm-dd')||' 18:00:00','yyyy-mm-dd hh24:mi:ss')
		 and create_date &lt; to_date(to_char(sysdate-1,'yyyy-mm-dd')||' 19:00:00','yyyy-mm-dd hh24:mi:ss')  and order_state in (2,3,5)
		 <choose>
		 	<when test="site_id !=null and site_id !=0">
		 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = t.user_name)
		 	</when>
		 	<when test="public_user_type != 1">
		 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = t.user_name)
		 	</when>
		 	<otherwise></otherwise>
		 </choose>
		 union all
		 select nvl(sum(payment_money),0) payment_money from tbl_order_info t where create_date >= to_date(to_char(sysdate-1,'yyyy-mm-dd')||' 19:00:00','yyyy-mm-dd hh24:mi:ss')
		 and create_date &lt; to_date(to_char(sysdate-1,'yyyy-mm-dd')||' 20:00:00','yyyy-mm-dd hh24:mi:ss')  and order_state in (2,3,5)
		 <choose>
		 	<when test="site_id !=null and site_id !=0">
		 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = t.user_name)
		 	</when>
		 	<when test="public_user_type != 1">
		 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = t.user_name)
		 	</when>
		 	<otherwise></otherwise>
		 </choose>
		 union all
		 select nvl(sum(payment_money),0) payment_money from tbl_order_info t where create_date >= to_date(to_char(sysdate-1,'yyyy-mm-dd')||' 20:00:00','yyyy-mm-dd hh24:mi:ss')
		 and create_date &lt; to_date(to_char(sysdate-1,'yyyy-mm-dd')||' 21:00:00','yyyy-mm-dd hh24:mi:ss')  and order_state in (2,3,5)
		 <choose>
		 	<when test="site_id !=null and site_id !=0">
		 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = t.user_name)
		 	</when>
		 	<when test="public_user_type != 1">
		 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = t.user_name)
		 	</when>
		 	<otherwise></otherwise>
		 </choose>
		 union all
		 select nvl(sum(payment_money),0) payment_money from tbl_order_info t where create_date >= to_date(to_char(sysdate-1,'yyyy-mm-dd')||' 21:00:00','yyyy-mm-dd hh24:mi:ss')
		 and create_date &lt; to_date(to_char(sysdate-1,'yyyy-mm-dd')||' 22:00:00','yyyy-mm-dd hh24:mi:ss')  and order_state in (2,3,5)
		 <choose>
		 	<when test="site_id !=null and site_id !=0">
		 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = t.user_name)
		 	</when>
		 	<when test="public_user_type != 1">
		 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = t.user_name)
		 	</when>
		 	<otherwise></otherwise>
		 </choose>
		 union all
		 select nvl(sum(payment_money),0) payment_money from tbl_order_info t where create_date >= to_date(to_char(sysdate-1,'yyyy-mm-dd')||' 22:00:00','yyyy-mm-dd hh24:mi:ss')
		 and create_date &lt; to_date(to_char(sysdate-1,'yyyy-mm-dd')||' 23:00:00','yyyy-mm-dd hh24:mi:ss')  and order_state in (2,3,5)
		 <choose>
		 	<when test="site_id !=null and site_id !=0">
		 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = t.user_name)
		 	</when>
		 	<when test="public_user_type != 1">
		 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = t.user_name)
		 	</when>
		 	<otherwise></otherwise>
		 </choose>
		 union all
		 select nvl(sum(payment_money),0) payment_money from tbl_order_info t where create_date >= to_date(to_char(sysdate-1,'yyyy-mm-dd')||' 23:00:00','yyyy-mm-dd hh24:mi:ss')
		 and create_date &lt;= to_date(to_char(sysdate-1,'yyyy-mm-dd')||' 23:59:59','yyyy-mm-dd hh24:mi:ss')  and order_state in (2,3,5)
		 <choose>
		 	<when test="site_id !=null and site_id !=0">
		 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = t.user_name)
		 	</when>
		 	<when test="public_user_type != 1">
		 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = t.user_name)
		 	</when>
		 	<otherwise></otherwise>
		 </choose>
	</select>
	<!-- 5：废弃 -->
	<select id="queryRealTimeVisitor" parameterType="java.util.Map" resultType="java.util.Map">
		select rownum rn,
				temp.page_name,
  				temp.count,
  				(select product_img_url from tbl_product_info where itemnumber = temp.page_name) product_img_url,
  				(select product_name from tbl_product_info where itemnumber = temp.page_name) product_name from (
		  select page_name,count(page_name) count
		   from tbl_user_log_info t
		  where create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 00:00:00','yyyy-mm-dd hh24:mi:ss')
		    and create_date &lt;= to_date(to_char(sysdate,'yyyy-mm-dd')||' 23:59:59','yyyy-mm-dd hh24:mi:ss')
		    <choose>
		 	<when test="site_id !=null and site_id !=0">
		 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = t.create_user_name)
		 	</when>
		 	<when test="public_user_type != 1">
		 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = t.create_user_name)
		 	</when>
		 	<otherwise></otherwise>
		    </choose>
		    and page_type='商品详情' group by page_name
		    order by count desc
		    ) temp
		    where rownum &lt;= #{num,jdbcType=INTEGER}
	</select>
	<!-- 商品浏览排行榜(移动端、PC端) -->
  	<select id="queryProductBrowse" parameterType="java.util.Map" resultType="java.util.Map">
  		select rownum rn,
  				temp.page_name,
  				temp.count,
  				(select product_img_url from tbl_product_info where itemnumber = temp.page_name) product_img_url,
  				(select product_name from tbl_product_info where itemnumber = temp.page_name) product_name from (
		  select page_name,count(page_name) count
		   from tbl_user_log_info t
		  where create_date >= to_date(#{start_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
		    and create_date &lt;= to_date(#{end_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
		    and page_type='商品详情'
		    <choose>
			 	<when test="site_id !=null and site_id !=0">
			 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = t.create_user_name)
			 	</when>
			 	<when test="public_user_type != 1">
			 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = t.create_user_name)
			 	</when>
			 	<otherwise></otherwise>
		    </choose>
		    and source_type=#{source_type,jdbcType=CHAR} group by page_name
		    order by count desc
		    ) temp
		    where rownum &lt;= #{num,jdbcType=INTEGER}
  	</select>
  	<!-- 销售商品排行榜 -->
  	<select id="queryProductRank" parameterType="java.util.Map" resultType="java.util.Map">
  		select rownum rn,temp.itemnumber,temp.count,pi.product_name,pi.product_img_url from
			(select itemnumber,sum(product_count) count 
			  from tbl_order_product t
			  <where>
				  	exists (select 1 from tbl_order_info temp where order_state in (2,3,5)
				    and create_date >= to_date(#{start_date,jdbcType=VARCHAR},'YYYY-MM-DD HH24:MI:SS')
				    and create_date &lt;= to_date(#{end_date,jdbcType=VARCHAR},'YYYY-MM-DD HH24:MI:SS') 
				    and order_number = t.order_number
			    <choose>
				 	<when test="site_id !=null and site_id !=0">
				 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = temp.user_name)
				 	</when>
				 	<when test="public_user_type != 1">
				 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = temp.user_name)
				 	</when>
				 	<otherwise></otherwise>
				 </choose>)
			  	<choose>
				 	<when test="site_id !=null and site_id !=0">
				 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = t.user_name)
				 	</when>
				 	<when test="public_user_type != 1">
				 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = t.user_name)
				 	</when>
				 	<otherwise></otherwise>
				 </choose>
			  </where>
			  group by itemnumber
			  order by count desc) temp,tbl_product_info pi
              where  temp.itemnumber = pi.itemnumber and rownum &lt;= #{num,jdbcType=INTEGER}
  	</select>
  	<!-- 销售区域排行榜 -->
  	<select id="queryAreaRank" parameterType="java.util.Map" resultType="java.util.Map">
  		select rownum rn,a.address_name,a.count from
		     (select address_name,sum(product_count) count from (
			     	select substr (receiving_address,0,instr (receiving_address, ',', 1) - 1) address_name,product_count
          			from tbl_order_info t
			        <where>
			        	order_state in (2,3,5)
			        	and create_date >= to_date(#{area_start_date,jdbcType=VARCHAR},'YYYY-MM-DD HH24:MI:SS')
					    and create_date &lt;= to_date(#{area_end_date,jdbcType=VARCHAR},'YYYY-MM-DD HH24:MI:SS') 
			        	<choose>
						 	<when test="site_id !=null and site_id !=0">
						 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = t.user_name)
						 	</when>
						 	<when test="public_user_type != 1">
						 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = t.user_name)
						 	</when>
						 	<otherwise></otherwise>
						 </choose>
			        </where>
			        ) group by address_name
			     order by count desc) a
			     where address_name is not null
  	</select>
  	<!-- 查询区域销售商品排行 -->
  	<select id="queryAreaProductRank" parameterType="java.util.Map" resultType="java.util.Map">
  			select rownum rn,a.* from (select temp.itemnumber,temp.count,pi.product_name,pi.product_img_url from
			(select itemnumber,sum(product_count) count 
			  from tbl_order_product t
			  <where>
				  	exists (select 1 from tbl_order_info temp where order_state in (2,3,5)
				    and create_date >= to_date(#{start_date,jdbcType=VARCHAR},'YYYY-MM-DD HH24:MI:SS')
				    and create_date &lt;= to_date(#{end_date,jdbcType=VARCHAR},'YYYY-MM-DD HH24:MI:SS') 
				    and order_number = t.order_number
				    and receiving_address like '%'||#{address_name,jdbcType=VARCHAR}||'%'
			    <choose>
				 	<when test="site_id !=null and site_id !=0">
				 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = temp.user_name)
				 	</when>
				 	<when test="public_user_type != 1">
				 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = temp.user_name)
				 	</when>
				 	<otherwise></otherwise>
				 </choose>)
			  	<choose>
				 	<when test="site_id !=null and site_id !=0">
				 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = t.user_name)
				 	</when>
				 	<when test="public_user_type != 1">
				 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = t.user_name)
				 	</when>
				 	<otherwise></otherwise>
				 </choose>
			  </where>
			  group by itemnumber) temp,tbl_product_info pi
              where  temp.itemnumber = pi.itemnumber
              order by count desc) a where rownum &lt;= #{num,jdbcType=INTEGER}
  	</select>
  	<!-- 滞销排行 -->
  	<select id="queryUnsalableRank" parameterType="java.util.Map" resultType="java.util.Map">
  		select rownum rn,a.product_itemnumber,(select product_img_url from tbl_product_info where itemnumber=a.product_itemnumber) product_img_url,(select product_name from tbl_product_info where itemnumber=a.product_itemnumber) product_name,
  		case when a.count &lt; 0 then 0 else a.count end count from( 
			select temp3.product_itemnumber,sum(count) count from tbl_product_sku temp3,(select PRODUCT_SKU,sum(PRODUCT_TOTAL_COUNT)-sum(PRODUCT_ORDER_OCCUPY_COUNT) count from TBL_PRODUCT_SKU_STOCK group by PRODUCT_SKU) temp4 
			   where exists (
			    select 1 from tbl_order_product temp2 where not exists(
			    select 1 from tbl_order_product temp where exists
			    (select 1 from tbl_order_info t where order_state in (2,3,5)
			    and create_date >= to_date(#{start_date,jdbcType=VARCHAR},'YYYY-MM-DD HH24:MI:SS')
			    and create_date &lt;= to_date(#{end_date,jdbcType=VARCHAR},'YYYY-MM-DD HH24:MI:SS') 
			    and order_number = temp.order_number
			    <choose>
				 	<when test="site_id !=null and site_id !=0">
				 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = t.user_name)
				 	</when>
				 	<when test="public_user_type != 1">
				 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = t.user_name)
				 	</when>
				 	<otherwise></otherwise>
				 </choose>)
			    and itemnumber = temp2.itemnumber
			    <choose>
				 	<when test="site_id !=null and site_id !=0">
				 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = temp.user_name)
				 	</when>
				 	<when test="public_user_type != 1">
				 			and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = temp.user_name)
				 	</when>
				 	<otherwise></otherwise>
				 </choose>
			    group by itemnumber) 
			    and itemnumber = temp3.product_itemnumber
			    <choose>
				 	<when test="site_id !=null and site_id !=0">
				 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = temp2.user_name)
				 	</when>
				 	<when test="public_user_type != 1">
				 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = temp2.user_name)
				 	</when>
				 	<otherwise></otherwise>
				 </choose>
			    group by itemnumber)
			    and temp3.id = temp4.product_sku
			    group by temp3.product_itemnumber
			    order by count desc) a
			    where rownum &lt;= #{num,jdbcType=INTEGER}
  	</select>
  	<!-- 频道热度概况(移动端、PC端)浏览量 -->
  	<select id="queryChannelHeatPv" parameterType="java.util.Map" resultType="java.util.Map">
  	select *	
  	from (select a.page_id,nvl((select page_name from tbl_decorate_page where id = a.page_id),0) page_name,count(1) cnt,TO_CHAR (CREATE_DATE, 'YYYY-MM-DD') create_date from
			(
			select case when instr (page_url, '&amp;', 1) = 0 then substr (page_url, instr (page_url, '=', 1) + 1, length (page_url)-1)
       					else substr (page_url, instr (page_url, '=', 1)+1, instr (page_url, '&amp;', 1) - instr (page_url, '=', 1)-1)
       					end page_id,create_date
			  from tbl_user_log_info t
			  where page_type='频道页'
			   and create_date >= to_date(#{start_date,jdbcType=VARCHAR},'YYYY-MM-DD HH24:MI:SS')
			    and create_date &lt;= to_date(#{end_date,jdbcType=VARCHAR},'YYYY-MM-DD HH24:MI:SS')
			    and source_type = #{source_type,jdbcType=CHAR}
			    <choose>
				 	<when test="site_id !=null and site_id !=0">
				 		and site_id = #{site_id,jdbcType=INTEGER}
				 	</when>
				 	<when test="public_user_type != 1">
				 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
				 	</when>
				 	<otherwise></otherwise>
				 </choose>
			  ) a
			  where length(a.page_id) = 8
			group by page_id,TO_CHAR (CREATE_DATE, 'YYYY-MM-DD') )b
	where 1=1
		<if test="site_id !=null and site_id !=0">
			and exists (select 1 from tbl_decorate_page c where c.site_id = #{site_id,jdbcType=INTEGER} and c.id = b.page_id and exists (select 1 from tbl_decorate_template where id = c.template_id and support_flag = #{source_type,jdbcType=CHAR}))
		</if>
		union all
        select '8888' page_id,'首页(系统)' page_name, count(1) cnt,TO_CHAR (CREATE_DATE, 'YYYY-MM-DD') create_date
          from tbl_user_log_info t
         where page_type='首页'
               and create_date >= to_date(#{start_date,jdbcType=VARCHAR},'YYYY-MM-DD HH24:MI:SS')
               and create_date &lt;= to_date(#{end_date,jdbcType=VARCHAR},'YYYY-MM-DD HH24:MI:SS')
               and source_type = #{source_type,jdbcType=CHAR}
               <choose>
				 	<when test="site_id !=null and site_id !=0">
				 		and site_id = #{site_id,jdbcType=INTEGER}
				 	</when>
				 	<when test="public_user_type != 1">
				 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
				 	</when>
				 	<otherwise></otherwise>
				 </choose>
               group by page_name,TO_CHAR (CREATE_DATE, 'YYYY-MM-DD')
  	</select>
  	<!-- 频道热度概况(移动端、PC端)访客数 -->
  	<select id="queryChannelHeatVisitor" parameterType="java.util.Map" resultType="java.util.Map">
  	select *	
  	  from (select a.page_id,nvl((select page_name from tbl_decorate_page where id = a.page_id),0) page_name,count(distinct create_user_name) cnt,TO_CHAR (CREATE_DATE, 'YYYY-MM-DD') create_date from
			(select case when instr (page_url, '&amp;', 1) = 0 then substr (page_url, instr (page_url, '=', 1) + 1, length (page_url)-1)
       					else substr (page_url, instr (page_url, '=', 1)+1, instr (page_url, '&amp;', 1) - instr (page_url, '=', 1)-1)
       					end page_id,create_date,create_user_name
			  from tbl_user_log_info t
			  where page_type='频道页'
			   and create_date >= to_date(#{start_date,jdbcType=VARCHAR},'YYYY-MM-DD HH24:MI:SS')
			    and create_date &lt;= to_date(#{end_date,jdbcType=VARCHAR},'YYYY-MM-DD HH24:MI:SS')
			    and source_type = #{source_type,jdbcType=CHAR}
			    <choose>
				 	<when test="site_id !=null and site_id !=0">
				 		and site_id = #{site_id,jdbcType=INTEGER}
				 	</when>
				 	<when test="public_user_type != 1">
				 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
				 	</when>
				 	<otherwise></otherwise>
				 </choose>) a 
				 where length(a.page_id) = 8 group by page_id,TO_CHAR (CREATE_DATE, 'YYYY-MM-DD'))b
	  where 1=1
		<if test="site_id !=null and site_id !=0">
			and exists (select 1 from tbl_decorate_page c where c.site_id = #{site_id,jdbcType=INTEGER} and c.id = b.page_id and exists (select 1 from tbl_decorate_template where id = c.template_id and support_flag = #{source_type,jdbcType=CHAR}))
		</if>
		union all
        select '8888' page_id,'首页(系统)' page_name, count(distinct create_user_name) cnt,TO_CHAR (CREATE_DATE, 'YYYY-MM-DD') create_date
          from tbl_user_log_info t
         where page_type='首页'
               and create_date >= to_date(#{start_date,jdbcType=VARCHAR},'YYYY-MM-DD HH24:MI:SS')
               and create_date &lt;= to_date(#{end_date,jdbcType=VARCHAR},'YYYY-MM-DD HH24:MI:SS')
               and source_type = #{source_type,jdbcType=CHAR}
               <choose>
				 	<when test="site_id !=null and site_id !=0">
				 		and site_id = #{site_id,jdbcType=INTEGER}
				 	</when>
				 	<when test="public_user_type != 1">
				 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
				 	</when>
				 	<otherwise></otherwise>
				 </choose>
               group by page_name,TO_CHAR (CREATE_DATE, 'YYYY-MM-DD')		
  	</select>
  	<!-- 频道热度概况(移动端、PC端)浏览量(今天) -->
  	<select id="queryChannelHeatPvTd" parameterType="java.util.Map" resultType="java.util.Map">
  	select * 
  	from (select a.page_id,nvl((select page_name from tbl_decorate_page where id = a.page_id),0) page_name,count(1) cnt,'01:00' create_date from
			(select case when instr (page_url, '&amp;', 1) = 0 then substr (page_url, instr (page_url, '=', 1) + 1, length (page_url)-1)
       					else substr (page_url, instr (page_url, '=', 1)+1, instr (page_url, '&amp;', 1) - instr (page_url, '=', 1)-1)
       					end page_id
			  from tbl_user_log_info t
			  where page_type='频道页'
			    and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 00:00:00','yyyy-mm-dd hh24:mi:ss')
			    and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 01:00:00','yyyy-mm-dd hh24:mi:ss')
			    and source_type = #{source_type,jdbcType=CHAR}
			    <choose>
				 	<when test="site_id !=null and site_id !=0">
				 		and site_id = #{site_id,jdbcType=INTEGER}
				 	</when>
				 	<when test="public_user_type != 1">
				 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
				 	</when>
				 	<otherwise></otherwise>
				 </choose>) a 
				 where length(a.page_id) = 8 group by page_id
				union all
           select '8888' page_id,'首页(系统)' page_name, count(1) cnt,'01:00' create_date
             from tbl_user_log_info t
            where page_type='首页'
                  and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 00:00:00','yyyy-mm-dd hh24:mi:ss')
			      and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 01:00:00','yyyy-mm-dd hh24:mi:ss')
			      and source_type = #{source_type,jdbcType=CHAR}
				    <choose>
					 	<when test="site_id !=null and site_id !=0">
					 		and site_id = #{site_id,jdbcType=INTEGER}
					 	</when>
					 	<when test="public_user_type != 1">
					 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
					 	</when>
					 	<otherwise></otherwise>
					 </choose>
                group by page_name
				union all
		select a.page_id,nvl((select page_name from tbl_decorate_page where id = a.page_id),0) page_name,count(1) cnt,'02:00' create_date from
			(select case when instr (page_url, '&amp;', 1) = 0 then substr (page_url, instr (page_url, '=', 1) + 1, length (page_url)-1)
       					else substr (page_url, instr (page_url, '=', 1)+1, instr (page_url, '&amp;', 1) - instr (page_url, '=', 1)-1)
       					end page_id
			  from tbl_user_log_info t
			  where page_type='频道页'
			    and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 01:00:00','yyyy-mm-dd hh24:mi:ss')
			    and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 02:00:00','yyyy-mm-dd hh24:mi:ss')
			    and source_type = #{source_type,jdbcType=CHAR}
			    <choose>
				 	<when test="site_id !=null and site_id !=0">
				 		and site_id = #{site_id,jdbcType=INTEGER}
				 	</when>
				 	<when test="public_user_type != 1">
				 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
				 	</when>
				 	<otherwise></otherwise>
				 </choose>) a 
				 where length(a.page_id) = 8 group by page_id
				union all
           select '8888' page_id,'首页(系统)' page_name, count(1) cnt,'02:00' create_date
             from tbl_user_log_info t
            where page_type='首页'
                  and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 01:00:00','yyyy-mm-dd hh24:mi:ss')
			      and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 02:00:00','yyyy-mm-dd hh24:mi:ss')
			      and source_type = #{source_type,jdbcType=CHAR}
				    <choose>
					 	<when test="site_id !=null and site_id !=0">
					 		and site_id = #{site_id,jdbcType=INTEGER}
					 	</when>
					 	<when test="public_user_type != 1">
					 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
					 	</when>
					 	<otherwise></otherwise>
					 </choose>
                group by page_name
			    union all
		select a.page_id,nvl((select page_name from tbl_decorate_page where id = a.page_id),0) page_name,count(1) cnt,'03:00' create_date from
			(select case when instr (page_url, '&amp;', 1) = 0 then substr (page_url, instr (page_url, '=', 1) + 1, length (page_url)-1)
       					else substr (page_url, instr (page_url, '=', 1)+1, instr (page_url, '&amp;', 1) - instr (page_url, '=', 1)-1)
       					end page_id
			  from tbl_user_log_info t
			  where page_type='频道页'
			    and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 02:00:00','yyyy-mm-dd hh24:mi:ss')
			    and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 03:00:00','yyyy-mm-dd hh24:mi:ss')
			    and source_type = #{source_type,jdbcType=CHAR}
			    <choose>
				 	<when test="site_id !=null and site_id !=0">
				 		and site_id = #{site_id,jdbcType=INTEGER}
				 	</when>
				 	<when test="public_user_type != 1">
				 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
				 	</when>
				 	<otherwise></otherwise>
				 </choose>) a 
				 where length(a.page_id) = 8 group by page_id
				union all
           select '8888' page_id,'首页(系统)' page_name, count(1) cnt,'03:00' create_date
             from tbl_user_log_info t
            where page_type='首页'
                  and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 02:00:00','yyyy-mm-dd hh24:mi:ss')
			      and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 03:00:00','yyyy-mm-dd hh24:mi:ss')
			      and source_type = #{source_type,jdbcType=CHAR}
				    <choose>
					 	<when test="site_id !=null and site_id !=0">
					 		and site_id = #{site_id,jdbcType=INTEGER}
					 	</when>
					 	<when test="public_user_type != 1">
					 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
					 	</when>
					 	<otherwise></otherwise>
					 </choose>
                group by page_name
			    union all
		select a.page_id,nvl((select page_name from tbl_decorate_page where id = a.page_id),0) page_name,count(1) cnt,'04:00' create_date from
			(select case when instr (page_url, '&amp;', 1) = 0 then substr (page_url, instr (page_url, '=', 1) + 1, length (page_url)-1)
       					else substr (page_url, instr (page_url, '=', 1)+1, instr (page_url, '&amp;', 1) - instr (page_url, '=', 1)-1)
       					end page_id
			  from tbl_user_log_info t
			  where page_type='频道页'
			    and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 03:00:00','yyyy-mm-dd hh24:mi:ss')
			    and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 04:00:00','yyyy-mm-dd hh24:mi:ss')
			    and source_type = #{source_type,jdbcType=CHAR}
			    <choose>
				 	<when test="site_id !=null and site_id !=0">
				 		and site_id = #{site_id,jdbcType=INTEGER}
				 	</when>
				 	<when test="public_user_type != 1">
				 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
				 	</when>
				 	<otherwise></otherwise>
				 </choose>) a 
				 where length(a.page_id) = 8 group by page_id
				union all
           select '8888' page_id,'首页(系统)' page_name, count(1) cnt,'04:00' create_date
             from tbl_user_log_info t
            where page_type='首页'
                  and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 03:00:00','yyyy-mm-dd hh24:mi:ss')
			      and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 04:00:00','yyyy-mm-dd hh24:mi:ss')
			      and source_type = #{source_type,jdbcType=CHAR}
				    <choose>
					 	<when test="site_id !=null and site_id !=0">
					 		and site_id = #{site_id,jdbcType=INTEGER}
					 	</when>
					 	<when test="public_user_type != 1">
					 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
					 	</when>
					 	<otherwise></otherwise>
					 </choose>
                group by page_name
			    union all
		select a.page_id,nvl((select page_name from tbl_decorate_page where id = a.page_id),0) page_name,count(1) cnt,'05:00' create_date from
			(select case when instr (page_url, '&amp;', 1) = 0 then substr (page_url, instr (page_url, '=', 1) + 1, length (page_url)-1)
       					else substr (page_url, instr (page_url, '=', 1)+1, instr (page_url, '&amp;', 1) - instr (page_url, '=', 1)-1)
       					end page_id
			  from tbl_user_log_info t
			  where page_type='频道页'
			    and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 04:00:00','yyyy-mm-dd hh24:mi:ss')
			    and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 05:00:00','yyyy-mm-dd hh24:mi:ss')
			    and source_type = #{source_type,jdbcType=CHAR}
			    <choose>
				 	<when test="site_id !=null and site_id !=0">
				 		and site_id = #{site_id,jdbcType=INTEGER}
				 	</when>
				 	<when test="public_user_type != 1">
				 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
				 	</when>
				 	<otherwise></otherwise>
				 </choose>) a 
				 where length(a.page_id) = 8 group by page_id
				union all
           select '8888' page_id,'首页(系统)' page_name, count(1) cnt,'05:00' create_date
             from tbl_user_log_info t
            where page_type='首页'
                  and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 04:00:00','yyyy-mm-dd hh24:mi:ss')
			      and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 05:00:00','yyyy-mm-dd hh24:mi:ss')
			      and source_type = #{source_type,jdbcType=CHAR}
				    <choose>
					 	<when test="site_id !=null and site_id !=0">
					 		and site_id = #{site_id,jdbcType=INTEGER}
					 	</when>
					 	<when test="public_user_type != 1">
					 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
					 	</when>
					 	<otherwise></otherwise>
					 </choose>
                group by page_name
			    union all
		select a.page_id,nvl((select page_name from tbl_decorate_page where id = a.page_id),0) page_name,count(1) cnt,'06:00' create_date from
			(select case when instr (page_url, '&amp;', 1) = 0 then substr (page_url, instr (page_url, '=', 1) + 1, length (page_url)-1)
       					else substr (page_url, instr (page_url, '=', 1)+1, instr (page_url, '&amp;', 1) - instr (page_url, '=', 1)-1)
       					end page_id
			  from tbl_user_log_info t
			  where page_type='频道页'
			    and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 05:00:00','yyyy-mm-dd hh24:mi:ss')
			    and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 06:00:00','yyyy-mm-dd hh24:mi:ss')
			    and source_type = #{source_type,jdbcType=CHAR}
			    <choose>
				 	<when test="site_id !=null and site_id !=0">
				 		and site_id = #{site_id,jdbcType=INTEGER}
				 	</when>
				 	<when test="public_user_type != 1">
				 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
				 	</when>
				 	<otherwise></otherwise>
				 </choose>) a 
				 where length(a.page_id) = 8 group by page_id
				union all
           select '8888' page_id,'首页(系统)' page_name, count(1) cnt,'06:00' create_date
             from tbl_user_log_info t
            where page_type='首页'
                  and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 05:00:00','yyyy-mm-dd hh24:mi:ss')
			      and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 06:00:00','yyyy-mm-dd hh24:mi:ss')
			      and source_type = #{source_type,jdbcType=CHAR}
				    <choose>
					 	<when test="site_id !=null and site_id !=0">
					 		and site_id = #{site_id,jdbcType=INTEGER}
					 	</when>
					 	<when test="public_user_type != 1">
					 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
					 	</when>
					 	<otherwise></otherwise>
					 </choose>
                group by page_name
			    union all
		select a.page_id,nvl((select page_name from tbl_decorate_page where id = a.page_id),0) page_name,count(1) cnt,'07:00' create_date from
			(select case when instr (page_url, '&amp;', 1) = 0 then substr (page_url, instr (page_url, '=', 1) + 1, length (page_url)-1)
       					else substr (page_url, instr (page_url, '=', 1)+1, instr (page_url, '&amp;', 1) - instr (page_url, '=', 1)-1)
       					end page_id
			  from tbl_user_log_info t
			  where page_type='频道页'
			    and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 06:00:00','yyyy-mm-dd hh24:mi:ss')
			    and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 07:00:00','yyyy-mm-dd hh24:mi:ss')
			    and source_type = #{source_type,jdbcType=CHAR}
			    <choose>
				 	<when test="site_id !=null and site_id !=0">
				 		and site_id = #{site_id,jdbcType=INTEGER}
				 	</when>
				 	<when test="public_user_type != 1">
				 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
				 	</when>
				 	<otherwise></otherwise>
				 </choose>) a 
				 where length(a.page_id) = 8 group by page_id
				union all
           select '8888' page_id,'首页(系统)' page_name, count(1) cnt,'07:00' create_date
             from tbl_user_log_info t
            where page_type='首页'
                  and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 06:00:00','yyyy-mm-dd hh24:mi:ss')
			      and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 07:00:00','yyyy-mm-dd hh24:mi:ss')
			      and source_type = #{source_type,jdbcType=CHAR}
				    <choose>
					 	<when test="site_id !=null and site_id !=0">
					 		and site_id = #{site_id,jdbcType=INTEGER}
					 	</when>
					 	<when test="public_user_type != 1">
					 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
					 	</when>
					 	<otherwise></otherwise>
					 </choose>
                group by page_name
			    union all
		select a.page_id,nvl((select page_name from tbl_decorate_page where id = a.page_id),0) page_name,count(1) cnt,'08:00' create_date from
			(select case when instr (page_url, '&amp;', 1) = 0 then substr (page_url, instr (page_url, '=', 1) + 1, length (page_url)-1)
       					else substr (page_url, instr (page_url, '=', 1)+1, instr (page_url, '&amp;', 1) - instr (page_url, '=', 1)-1)
       					end page_id
			  from tbl_user_log_info t
			  where page_type='频道页'
			    and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 07:00:00','yyyy-mm-dd hh24:mi:ss')
			    and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 08:00:00','yyyy-mm-dd hh24:mi:ss')
			    and source_type = #{source_type,jdbcType=CHAR}
			    <choose>
				 	<when test="site_id !=null and site_id !=0">
				 		and site_id = #{site_id,jdbcType=INTEGER}
				 	</when>
				 	<when test="public_user_type != 1">
				 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
				 	</when>
				 	<otherwise></otherwise>
				 </choose>) a 
				 where length(a.page_id) = 8 group by page_id
				union all
           select '8888' page_id,'首页(系统)' page_name, count(1) cnt,'08:00' create_date
             from tbl_user_log_info t
            where page_type='首页'
                  and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 07:00:00','yyyy-mm-dd hh24:mi:ss')
			      and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 08:00:00','yyyy-mm-dd hh24:mi:ss')
			      and source_type = #{source_type,jdbcType=CHAR}
				    <choose>
					 	<when test="site_id !=null and site_id !=0">
					 		and site_id = #{site_id,jdbcType=INTEGER}
					 	</when>
					 	<when test="public_user_type != 1">
					 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
					 	</when>
					 	<otherwise></otherwise>
					 </choose>
                group by page_name
			    union all
		select a.page_id,nvl((select page_name from tbl_decorate_page where id = a.page_id),0) page_name,count(1) cnt,'09:00' create_date from
			(select case when instr (page_url, '&amp;', 1) = 0 then substr (page_url, instr (page_url, '=', 1) + 1, length (page_url)-1)
       					else substr (page_url, instr (page_url, '=', 1)+1, instr (page_url, '&amp;', 1) - instr (page_url, '=', 1)-1)
       					end page_id
			  from tbl_user_log_info t
			  where page_type='频道页'
			    and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 08:00:00','yyyy-mm-dd hh24:mi:ss')
			    and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 09:00:00','yyyy-mm-dd hh24:mi:ss')
			    and source_type = #{source_type,jdbcType=CHAR}
			    <choose>
				 	<when test="site_id !=null and site_id !=0">
				 		and site_id = #{site_id,jdbcType=INTEGER}
				 	</when>
				 	<when test="public_user_type != 1">
				 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
				 	</when>
				 	<otherwise></otherwise>
				 </choose>) a 
				 where length(a.page_id) = 8 group by page_id
				union all
           select '8888' page_id,'首页(系统)' page_name, count(1) cnt,'09:00' create_date
             from tbl_user_log_info t
            where page_type='首页'
                  and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 08:00:00','yyyy-mm-dd hh24:mi:ss')
			      and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 09:00:00','yyyy-mm-dd hh24:mi:ss')
			      and source_type = #{source_type,jdbcType=CHAR}
				    <choose>
					 	<when test="site_id !=null and site_id !=0">
					 		and site_id = #{site_id,jdbcType=INTEGER}
					 	</when>
					 	<when test="public_user_type != 1">
					 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
					 	</when>
					 	<otherwise></otherwise>
					 </choose>
                group by page_name
			    union all
		select a.page_id,nvl((select page_name from tbl_decorate_page where id = a.page_id),0) page_name,count(1) cnt,'10:00' create_date from
			(select case when instr (page_url, '&amp;', 1) = 0 then substr (page_url, instr (page_url, '=', 1) + 1, length (page_url)-1)
       					else substr (page_url, instr (page_url, '=', 1)+1, instr (page_url, '&amp;', 1) - instr (page_url, '=', 1)-1)
       					end page_id
			  from tbl_user_log_info t
			  where page_type='频道页'
			    and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 09:00:00','yyyy-mm-dd hh24:mi:ss')
			    and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 10:00:00','yyyy-mm-dd hh24:mi:ss')
			    and source_type = #{source_type,jdbcType=CHAR}
			    <choose>
				 	<when test="site_id !=null and site_id !=0">
				 		and site_id = #{site_id,jdbcType=INTEGER}
				 	</when>
				 	<when test="public_user_type != 1">
				 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
				 	</when>
				 	<otherwise></otherwise>
				 </choose>) a 
				 where length(a.page_id) = 8 group by page_id
				union all
           select '8888' page_id,'首页(系统)' page_name, count(1) cnt,'10:00' create_date
             from tbl_user_log_info t
            where page_type='首页'
                  and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 09:00:00','yyyy-mm-dd hh24:mi:ss')
			      and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 10:00:00','yyyy-mm-dd hh24:mi:ss')
			      and source_type = #{source_type,jdbcType=CHAR}
				    <choose>
					 	<when test="site_id !=null and site_id !=0">
					 		and site_id = #{site_id,jdbcType=INTEGER}
					 	</when>
					 	<when test="public_user_type != 1">
					 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
					 	</when>
					 	<otherwise></otherwise>
					 </choose>
                group by page_name
			    union all
		select a.page_id,nvl((select page_name from tbl_decorate_page where id = a.page_id),0) page_name,count(1) cnt,'11:00' create_date from
			(select case when instr (page_url, '&amp;', 1) = 0 then substr (page_url, instr (page_url, '=', 1) + 1, length (page_url)-1)
       					else substr (page_url, instr (page_url, '=', 1)+1, instr (page_url, '&amp;', 1) - instr (page_url, '=', 1)-1)
       					end page_id
			  from tbl_user_log_info t
			  where page_type='频道页'
			    and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 10:00:00','yyyy-mm-dd hh24:mi:ss')
			    and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 11:00:00','yyyy-mm-dd hh24:mi:ss')
			    and source_type = #{source_type,jdbcType=CHAR}
			    <choose>
				 	<when test="site_id !=null and site_id !=0">
				 		and site_id = #{site_id,jdbcType=INTEGER}
				 	</when>
				 	<when test="public_user_type != 1">
				 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
				 	</when>
				 	<otherwise></otherwise>
				 </choose>) a 
				 where length(a.page_id) = 8 group by page_id
				union all
           select '8888' page_id,'首页(系统)' page_name, count(1) cnt,'11:00' create_date
             from tbl_user_log_info t
            where page_type='首页'
                  and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 10:00:00','yyyy-mm-dd hh24:mi:ss')
			      and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 11:00:00','yyyy-mm-dd hh24:mi:ss')
			      and source_type = #{source_type,jdbcType=CHAR}
				    <choose>
					 	<when test="site_id !=null and site_id !=0">
					 		and site_id = #{site_id,jdbcType=INTEGER}
					 	</when>
					 	<when test="public_user_type != 1">
					 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
					 	</when>
					 	<otherwise></otherwise>
					 </choose>
                group by page_name
			    union all
		select a.page_id,nvl((select page_name from tbl_decorate_page where id = a.page_id),0) page_name,count(1) cnt,'12:00' create_date from
			(select case when instr (page_url, '&amp;', 1) = 0 then substr (page_url, instr (page_url, '=', 1) + 1, length (page_url)-1)
       					else substr (page_url, instr (page_url, '=', 1)+1, instr (page_url, '&amp;', 1) - instr (page_url, '=', 1)-1)
       					end page_id
			  from tbl_user_log_info t
			  where page_type='频道页'
			    and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 11:00:00','yyyy-mm-dd hh24:mi:ss')
			    and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 12:00:00','yyyy-mm-dd hh24:mi:ss')
			    and source_type = #{source_type,jdbcType=CHAR}
			    <choose>
				 	<when test="site_id !=null and site_id !=0">
				 		and site_id = #{site_id,jdbcType=INTEGER}
				 	</when>
				 	<when test="public_user_type != 1">
				 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
				 	</when>
				 	<otherwise></otherwise>
				 </choose>) a 
				 where length(a.page_id) = 8 group by page_id
				union all
           select '8888' page_id,'首页(系统)' page_name, count(1) cnt,'12:00' create_date
             from tbl_user_log_info t
            where page_type='首页'
                  and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 11:00:00','yyyy-mm-dd hh24:mi:ss')
			      and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 12:00:00','yyyy-mm-dd hh24:mi:ss')
			      and source_type = #{source_type,jdbcType=CHAR}
				    <choose>
					 	<when test="site_id !=null and site_id !=0">
					 		and site_id = #{site_id,jdbcType=INTEGER}
					 	</when>
					 	<when test="public_user_type != 1">
					 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
					 	</when>
					 	<otherwise></otherwise>
					 </choose>
                group by page_name
			    union all
		select a.page_id,nvl((select page_name from tbl_decorate_page where id = a.page_id),0) page_name,count(1) cnt,'13:00' create_date from
			(select case when instr (page_url, '&amp;', 1) = 0 then substr (page_url, instr (page_url, '=', 1) + 1, length (page_url)-1)
       					else substr (page_url, instr (page_url, '=', 1)+1, instr (page_url, '&amp;', 1) - instr (page_url, '=', 1)-1)
       					end page_id
			  from tbl_user_log_info t
			  where page_type='频道页'
			    and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 12:00:00','yyyy-mm-dd hh24:mi:ss')
			    and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 13:00:00','yyyy-mm-dd hh24:mi:ss')
			    and source_type = #{source_type,jdbcType=CHAR}
			    <choose>
				 	<when test="site_id !=null and site_id !=0">
				 		and site_id = #{site_id,jdbcType=INTEGER}
				 	</when>
				 	<when test="public_user_type != 1">
				 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
				 	</when>
				 	<otherwise></otherwise>
				 </choose>) a 
				 where length(a.page_id) = 8 group by page_id	
				union all
           select '8888' page_id,'首页(系统)' page_name, count(1) cnt,'13:00' create_date
             from tbl_user_log_info t
            where page_type='首页'
                  and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 12:00:00','yyyy-mm-dd hh24:mi:ss')
			      and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 13:00:00','yyyy-mm-dd hh24:mi:ss')
			      and source_type = #{source_type,jdbcType=CHAR}
				    <choose>
					 	<when test="site_id !=null and site_id !=0">
					 		and site_id = #{site_id,jdbcType=INTEGER}
					 	</when>
					 	<when test="public_user_type != 1">
					 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
					 	</when>
					 	<otherwise></otherwise>
					 </choose>
                group by page_name
			    union all
		select a.page_id,nvl((select page_name from tbl_decorate_page where id = a.page_id),0) page_name,count(1) cnt,'14:00' create_date from
			(select case when instr (page_url, '&amp;', 1) = 0 then substr (page_url, instr (page_url, '=', 1) + 1, length (page_url)-1)
       					else substr (page_url, instr (page_url, '=', 1)+1, instr (page_url, '&amp;', 1) - instr (page_url, '=', 1)-1)
       					end page_id
			  from tbl_user_log_info t
			  where page_type='频道页'
			    and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 13:00:00','yyyy-mm-dd hh24:mi:ss')
			    and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 14:00:00','yyyy-mm-dd hh24:mi:ss')
			    and source_type = #{source_type,jdbcType=CHAR}
			    <choose>
				 	<when test="site_id !=null and site_id !=0">
				 		and site_id = #{site_id,jdbcType=INTEGER}
				 	</when>
				 	<when test="public_user_type != 1">
				 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
				 	</when>
				 	<otherwise></otherwise>
				 </choose>) a
				 where length(a.page_id) = 8 group by page_id
				union all
           select '8888' page_id,'首页(系统)' page_name, count(1) cnt,'14:00' create_date
             from tbl_user_log_info t
            where page_type='首页'
                  and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 13:00:00','yyyy-mm-dd hh24:mi:ss')
			      and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 14:00:00','yyyy-mm-dd hh24:mi:ss')
			      and source_type = #{source_type,jdbcType=CHAR}
				    <choose>
					 	<when test="site_id !=null and site_id !=0">
					 		and site_id = #{site_id,jdbcType=INTEGER}
					 	</when>
					 	<when test="public_user_type != 1">
					 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
					 	</when>
					 	<otherwise></otherwise>
					 </choose>
                group by page_name
			    union all
		select a.page_id,nvl((select page_name from tbl_decorate_page where id = a.page_id),0) page_name,count(1) cnt,'15:00' create_date from
			(select case when instr (page_url, '&amp;', 1) = 0 then substr (page_url, instr (page_url, '=', 1) + 1, length (page_url)-1)
       					else substr (page_url, instr (page_url, '=', 1)+1, instr (page_url, '&amp;', 1) - instr (page_url, '=', 1)-1)
       					end page_id
			  from tbl_user_log_info t
			  where page_type='频道页'
			    and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 14:00:00','yyyy-mm-dd hh24:mi:ss')
			    and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 15:00:00','yyyy-mm-dd hh24:mi:ss')
			    and source_type = #{source_type,jdbcType=CHAR}
			    <choose>
				 	<when test="site_id !=null and site_id !=0">
				 		and site_id = #{site_id,jdbcType=INTEGER}
				 	</when>
				 	<when test="public_user_type != 1">
				 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
				 	</when>
				 	<otherwise></otherwise>
				 </choose>) a
				 where length(a.page_id) = 8 group by page_id
				union all
           select '8888' page_id,'首页(系统)' page_name, count(1) cnt,'15:00' create_date
             from tbl_user_log_info t
            where page_type='首页'
                  and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 14:00:00','yyyy-mm-dd hh24:mi:ss')
			      and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 15:00:00','yyyy-mm-dd hh24:mi:ss')
			      and source_type = #{source_type,jdbcType=CHAR}
				    <choose>
					 	<when test="site_id !=null and site_id !=0">
					 		and site_id = #{site_id,jdbcType=INTEGER}
					 	</when>
					 	<when test="public_user_type != 1">
					 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
					 	</when>
					 	<otherwise></otherwise>
					 </choose>
                group by page_name
			    union all
		select a.page_id,nvl((select page_name from tbl_decorate_page where id = a.page_id),0) page_name,count(1) cnt,'16:00' create_date from
			(select case when instr (page_url, '&amp;', 1) = 0 then substr (page_url, instr (page_url, '=', 1) + 1, length (page_url)-1)
       					else substr (page_url, instr (page_url, '=', 1)+1, instr (page_url, '&amp;', 1) - instr (page_url, '=', 1)-1)
       					end page_id
			  from tbl_user_log_info t
			  where page_type='频道页'
			    and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 15:00:00','yyyy-mm-dd hh24:mi:ss')
			    and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 16:00:00','yyyy-mm-dd hh24:mi:ss')
			    and source_type = #{source_type,jdbcType=CHAR}
			    <choose>
				 	<when test="site_id !=null and site_id !=0">
				 		and site_id = #{site_id,jdbcType=INTEGER}
				 	</when>
				 	<when test="public_user_type != 1">
				 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
				 	</when>
				 	<otherwise></otherwise>
				 </choose>) a 
				 where length(a.page_id) = 8 group by page_id
				union all
           select '8888' page_id,'首页(系统)' page_name, count(1) cnt,'16:00' create_date
             from tbl_user_log_info t
            where page_type='首页'
                  and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 15:00:00','yyyy-mm-dd hh24:mi:ss')
			      and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 16:00:00','yyyy-mm-dd hh24:mi:ss')
			      and source_type = #{source_type,jdbcType=CHAR}
				    <choose>
					 	<when test="site_id !=null and site_id !=0">
					 		and site_id = #{site_id,jdbcType=INTEGER}
					 	</when>
					 	<when test="public_user_type != 1">
					 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
					 	</when>
					 	<otherwise></otherwise>
					 </choose>
                group by page_name
			    union all
		select a.page_id,nvl((select page_name from tbl_decorate_page where id = a.page_id),0) page_name,count(1) cnt,'17:00' create_date from
			(select case when instr (page_url, '&amp;', 1) = 0 then substr (page_url, instr (page_url, '=', 1) + 1, length (page_url)-1)
       					else substr (page_url, instr (page_url, '=', 1)+1, instr (page_url, '&amp;', 1) - instr (page_url, '=', 1)-1)
       					end page_id
			  from tbl_user_log_info t
			  where page_type='频道页'
			    and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 16:00:00','yyyy-mm-dd hh24:mi:ss')
			    and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 17:00:00','yyyy-mm-dd hh24:mi:ss')
			    and source_type = #{source_type,jdbcType=CHAR}
			    <choose>
				 	<when test="site_id !=null and site_id !=0">
				 		and site_id = #{site_id,jdbcType=INTEGER}
				 	</when>
				 	<when test="public_user_type != 1">
				 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
				 	</when>
				 	<otherwise></otherwise>
				 </choose>) a 
				 where length(a.page_id) = 8 group by page_id
				union all
           select '8888' page_id,'首页(系统)' page_name, count(1) cnt,'17:00' create_date
             from tbl_user_log_info t
            where page_type='首页'
                  and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 16:00:00','yyyy-mm-dd hh24:mi:ss')
			      and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 17:00:00','yyyy-mm-dd hh24:mi:ss')
			      and source_type = #{source_type,jdbcType=CHAR}
				    <choose>
					 	<when test="site_id !=null and site_id !=0">
					 		and site_id = #{site_id,jdbcType=INTEGER}
					 	</when>
					 	<when test="public_user_type != 1">
					 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
					 	</when>
					 	<otherwise></otherwise>
					 </choose>
                group by page_name
			    union all
		select a.page_id,nvl((select page_name from tbl_decorate_page where id = a.page_id),0) page_name,count(1) cnt,'18:00' create_date from
			(select case when instr (page_url, '&amp;', 1) = 0 then substr (page_url, instr (page_url, '=', 1) + 1, length (page_url)-1)
       					else substr (page_url, instr (page_url, '=', 1)+1, instr (page_url, '&amp;', 1) - instr (page_url, '=', 1)-1)
       					end page_id
			  from tbl_user_log_info t
			  where page_type='频道页'
			    and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 17:00:00','yyyy-mm-dd hh24:mi:ss')
			    and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 18:00:00','yyyy-mm-dd hh24:mi:ss')
			    and source_type = #{source_type,jdbcType=CHAR}
			    <choose>
				 	<when test="site_id !=null and site_id !=0">
				 		and site_id = #{site_id,jdbcType=INTEGER}
				 	</when>
				 	<when test="public_user_type != 1">
				 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
				 	</when>
				 	<otherwise></otherwise>
				 </choose>) a 
				 where length(a.page_id) = 8 group by page_id
				union all
           select '8888' page_id,'首页(系统)' page_name, count(1) cnt,'18:00' create_date
             from tbl_user_log_info t
            where page_type='首页'
                  and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 17:00:00','yyyy-mm-dd hh24:mi:ss')
			      and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 18:00:00','yyyy-mm-dd hh24:mi:ss')
			      and source_type = #{source_type,jdbcType=CHAR}
				    <choose>
					 	<when test="site_id !=null and site_id !=0">
					 		and site_id = #{site_id,jdbcType=INTEGER}
					 	</when>
					 	<when test="public_user_type != 1">
					 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
					 	</when>
					 	<otherwise></otherwise>
					 </choose>
                group by page_name
			    union all
		select a.page_id,nvl((select page_name from tbl_decorate_page where id = a.page_id),0) page_name,count(1) cnt,'19:00' create_date from
			(select case when instr (page_url, '&amp;', 1) = 0 then substr (page_url, instr (page_url, '=', 1) + 1, length (page_url)-1)
       					else substr (page_url, instr (page_url, '=', 1)+1, instr (page_url, '&amp;', 1) - instr (page_url, '=', 1)-1)
       					end page_id
			  from tbl_user_log_info t
			  where page_type='频道页'
			    and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 18:00:00','yyyy-mm-dd hh24:mi:ss')
			    and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 19:00:00','yyyy-mm-dd hh24:mi:ss')
			    and source_type = #{source_type,jdbcType=CHAR}
			    <choose>
				 	<when test="site_id !=null and site_id !=0">
				 		and site_id = #{site_id,jdbcType=INTEGER}
				 	</when>
				 	<when test="public_user_type != 1">
				 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
				 	</when>
				 	<otherwise></otherwise>
				 </choose>) a 
				 where length(a.page_id) = 8 group by page_id
				union all
           select '8888' page_id,'首页(系统)' page_name, count(1) cnt,'19:00' create_date
             from tbl_user_log_info t
            where page_type='首页'
                  and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 18:00:00','yyyy-mm-dd hh24:mi:ss')
			      and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 19:00:00','yyyy-mm-dd hh24:mi:ss')
			      and source_type = #{source_type,jdbcType=CHAR}
				    <choose>
					 	<when test="site_id !=null and site_id !=0">
					 		and site_id = #{site_id,jdbcType=INTEGER}
					 	</when>
					 	<when test="public_user_type != 1">
					 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
					 	</when>
					 	<otherwise></otherwise>
					 </choose>
                group by page_name
			    union all
		select a.page_id,nvl((select page_name from tbl_decorate_page where id = a.page_id),0) page_name,count(1) cnt,'20:00' create_date from
			(select case when instr (page_url, '&amp;', 1) = 0 then substr (page_url, instr (page_url, '=', 1) + 1, length (page_url)-1)
       					else substr (page_url, instr (page_url, '=', 1)+1, instr (page_url, '&amp;', 1) - instr (page_url, '=', 1)-1)
       					end page_id
			  from tbl_user_log_info t
			  where page_type='频道页'
			    and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 19:00:00','yyyy-mm-dd hh24:mi:ss')
			    and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 20:00:00','yyyy-mm-dd hh24:mi:ss')
			    and source_type = #{source_type,jdbcType=CHAR}
			    <choose>
				 	<when test="site_id !=null and site_id !=0">
				 		and site_id = #{site_id,jdbcType=INTEGER}
				 	</when>
				 	<when test="public_user_type != 1">
				 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
				 	</when>
				 	<otherwise></otherwise>
				 </choose>) a 
				 where length(a.page_id) = 8 group by page_id
				union all
           select '8888' page_id,'首页(系统)' page_name, count(1) cnt,'20:00' create_date
             from tbl_user_log_info t
            where page_type='首页'
                  and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 19:00:00','yyyy-mm-dd hh24:mi:ss')
			      and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 20:00:00','yyyy-mm-dd hh24:mi:ss')
			      and source_type = #{source_type,jdbcType=CHAR}
				    <choose>
					 	<when test="site_id !=null and site_id !=0">
					 		and site_id = #{site_id,jdbcType=INTEGER}
					 	</when>
					 	<when test="public_user_type != 1">
					 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
					 	</when>
					 	<otherwise></otherwise>
					 </choose>
                group by page_name
			    union all
		select a.page_id,nvl((select page_name from tbl_decorate_page where id = a.page_id),0) page_name,count(1) cnt,'21:00' create_date from
			(select case when instr (page_url, '&amp;', 1) = 0 then substr (page_url, instr (page_url, '=', 1) + 1, length (page_url)-1)
       					else substr (page_url, instr (page_url, '=', 1)+1, instr (page_url, '&amp;', 1) - instr (page_url, '=', 1)-1)
       					end page_id
			  from tbl_user_log_info t
			  where page_type='频道页'
			    and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 20:00:00','yyyy-mm-dd hh24:mi:ss')
			    and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 21:00:00','yyyy-mm-dd hh24:mi:ss')
			    and source_type = #{source_type,jdbcType=CHAR}
			    <choose>
				 	<when test="site_id !=null and site_id !=0">
				 		and site_id = #{site_id,jdbcType=INTEGER}
				 	</when>
				 	<when test="public_user_type != 1">
				 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
				 	</when>
				 	<otherwise></otherwise>
				 </choose>) a 
				 where length(a.page_id) = 8 group by page_id
				union all
           select '8888' page_id,'首页(系统)' page_name, count(1) cnt,'21:00' create_date
             from tbl_user_log_info t
            where page_type='首页'
                  and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 20:00:00','yyyy-mm-dd hh24:mi:ss')
			      and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 21:00:00','yyyy-mm-dd hh24:mi:ss')
			      and source_type = #{source_type,jdbcType=CHAR}
				    <choose>
					 	<when test="site_id !=null and site_id !=0">
					 		and site_id = #{site_id,jdbcType=INTEGER}
					 	</when>
					 	<when test="public_user_type != 1">
					 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
					 	</when>
					 	<otherwise></otherwise>
					 </choose>
                group by page_name
			    union all
		select a.page_id,nvl((select page_name from tbl_decorate_page where id = a.page_id),0) page_name,count(1) cnt,'22:00' create_date from
			(select case when instr (page_url, '&amp;', 1) = 0 then substr (page_url, instr (page_url, '=', 1) + 1, length (page_url)-1)
       					else substr (page_url, instr (page_url, '=', 1)+1, instr (page_url, '&amp;', 1) - instr (page_url, '=', 1)-1)
       					end page_id
			  from tbl_user_log_info t
			  where page_type='频道页'
			    and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 21:00:00','yyyy-mm-dd hh24:mi:ss')
			    and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 22:00:00','yyyy-mm-dd hh24:mi:ss')
			    and source_type = #{source_type,jdbcType=CHAR}
			    <choose>
				 	<when test="site_id !=null and site_id !=0">
				 		and site_id = #{site_id,jdbcType=INTEGER}
				 	</when>
				 	<when test="public_user_type != 1">
				 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
				 	</when>
				 	<otherwise></otherwise>
				 </choose>) a 
				 where length(a.page_id) = 8 group by page_id
				union all
           select '8888' page_id,'首页(系统)' page_name, count(1) cnt,'22:00' create_date
             from tbl_user_log_info t
            where page_type='首页'
                  and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 21:00:00','yyyy-mm-dd hh24:mi:ss')
			      and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 22:00:00','yyyy-mm-dd hh24:mi:ss')
			      and source_type = #{source_type,jdbcType=CHAR}
				    <choose>
					 	<when test="site_id !=null and site_id !=0">
					 		and site_id = #{site_id,jdbcType=INTEGER}
					 	</when>
					 	<when test="public_user_type != 1">
					 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
					 	</when>
					 	<otherwise></otherwise>
					 </choose>
                group by page_name
			    union all
		select a.page_id,nvl((select page_name from tbl_decorate_page where id = a.page_id),0) page_name,count(1) cnt,'23:00' create_date from
			(select case when instr (page_url, '&amp;', 1) = 0 then substr (page_url, instr (page_url, '=', 1) + 1, length (page_url)-1)
       					else substr (page_url, instr (page_url, '=', 1)+1, instr (page_url, '&amp;', 1) - instr (page_url, '=', 1)-1)
       					end page_id
			  from tbl_user_log_info t
			  where page_type='频道页'
			    and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 22:00:00','yyyy-mm-dd hh24:mi:ss')
			    and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 23:00:00','yyyy-mm-dd hh24:mi:ss')
			    and source_type = #{source_type,jdbcType=CHAR}
			    <choose>
				 	<when test="site_id !=null and site_id !=0">
				 		and site_id = #{site_id,jdbcType=INTEGER}
				 	</when>
				 	<when test="public_user_type != 1">
				 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
				 	</when>
				 	<otherwise></otherwise>
				 </choose>) a 
				 where length(a.page_id) = 8 group by page_id
				union all
           select '8888' page_id,'首页(系统)' page_name, count(1) cnt,'23:00' create_date
             from tbl_user_log_info t
            where page_type='首页'
                  and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 22:00:00','yyyy-mm-dd hh24:mi:ss')
			      and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 23:00:00','yyyy-mm-dd hh24:mi:ss')
			      and source_type = #{source_type,jdbcType=CHAR}
				    <choose>
					 	<when test="site_id !=null and site_id !=0">
					 		and site_id = #{site_id,jdbcType=INTEGER}
					 	</when>
					 	<when test="public_user_type != 1">
					 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
					 	</when>
					 	<otherwise></otherwise>
					 </choose>
                group by page_name
			    union all
		select a.page_id,nvl((select page_name from tbl_decorate_page where id = a.page_id),0) page_name,count(1) cnt,'24:00' create_date from
			(select case when instr (page_url, '&amp;', 1) = 0 then substr (page_url, instr (page_url, '=', 1) + 1, length (page_url)-1)
       					else substr (page_url, instr (page_url, '=', 1)+1, instr (page_url, '&amp;', 1) - instr (page_url, '=', 1)-1)
       					end page_id
			  from tbl_user_log_info t
			  where page_type='频道页'
			    and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 23:00:00','yyyy-mm-dd hh24:mi:ss')
			    and create_date &lt;= to_date(to_char(sysdate,'yyyy-mm-dd')||' 23:59:59','yyyy-mm-dd hh24:mi:ss')
			    and source_type = #{source_type,jdbcType=CHAR}
			    <choose>
				 	<when test="site_id !=null and site_id !=0">
				 		and site_id = #{site_id,jdbcType=INTEGER}
				 	</when>
				 	<when test="public_user_type != 1">
				 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
				 	</when>
				 	<otherwise></otherwise>
				 </choose>) a 
				 where length(a.page_id) = 8 group by page_id
				 union all
           select '8888' page_id,'首页(系统)' page_name, count(1) cnt,'24:00' create_date
             from tbl_user_log_info t
            where page_type='首页'
                  and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 23:00:00','yyyy-mm-dd hh24:mi:ss')
			      and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 23:59:59','yyyy-mm-dd hh24:mi:ss')
			      and source_type = #{source_type,jdbcType=CHAR}
				    <choose>
					 	<when test="site_id !=null and site_id !=0">
					 		and site_id = #{site_id,jdbcType=INTEGER}
					 	</when>
					 	<when test="public_user_type != 1">
					 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
					 	</when>
					 	<otherwise></otherwise>
					 </choose>
                group by page_name) b
		where 1=1
		   <if test="site_id !=null and site_id !=0">
			  and exists (select 1 from tbl_decorate_page c where c.site_id = #{site_id,jdbcType=INTEGER} and c.id = b.page_id and exists (select 1 from tbl_decorate_template where id = c.template_id and support_flag = #{source_type,jdbcType=CHAR}))
		   </if>		 
  	</select>
  	<!-- 频道热度概况(移动端、PC端)访客数(今天) -->
  	<select id="queryChannelHeatVisitorTd" parameterType="java.util.Map" resultType="java.util.Map">
  	select * 
  	from (select a.page_id,nvl((select page_name from tbl_decorate_page where id = a.page_id),0) page_name,count(distinct create_user_name) cnt,'01:00' create_date from
			(select case when instr (page_url, '&amp;', 1) = 0 then substr (page_url, instr (page_url, '=', 1) + 1, length (page_url)-1)
       					else substr (page_url, instr (page_url, '=', 1)+1, instr (page_url, '&amp;', 1) - instr (page_url, '=', 1)-1)
       					end page_id,create_user_name
			  from tbl_user_log_info t
			  where page_type='频道页'
			    and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 00:00:00','yyyy-mm-dd hh24:mi:ss')
			    and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 01:00:00','yyyy-mm-dd hh24:mi:ss')
			    and source_type = #{source_type,jdbcType=CHAR}
			    <choose>
				 	<when test="site_id !=null and site_id !=0">
				 		and site_id = #{site_id,jdbcType=INTEGER}
				 	</when>
				 	<when test="public_user_type != 1">
				 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
				 	</when>
				 	<otherwise></otherwise>
				 </choose>) a 
				 where length(a.page_id) = 8 group by page_id
				union all
           select '8888' page_id,'首页(系统)' page_name, count(distinct create_user_name) cnt,'01:00' create_date
             from tbl_user_log_info t
            where page_type='首页'
                  and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 00:00:00','yyyy-mm-dd hh24:mi:ss')
			      and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 01:00:00','yyyy-mm-dd hh24:mi:ss')
			      and source_type = #{source_type,jdbcType=CHAR}
				    <choose>
					 	<when test="site_id !=null and site_id !=0">
					 		and site_id = #{site_id,jdbcType=INTEGER}
					 	</when>
					 	<when test="public_user_type != 1">
					 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
					 	</when>
					 	<otherwise></otherwise>
					 </choose>
                group by page_name
				union all
		select a.page_id,nvl((select page_name from tbl_decorate_page where id = a.page_id),0) page_name,count(distinct create_user_name) cnt,'02:00' create_date from
			(select case when instr (page_url, '&amp;', 1) = 0 then substr (page_url, instr (page_url, '=', 1) + 1, length (page_url)-1)
       					else substr (page_url, instr (page_url, '=', 1)+1, instr (page_url, '&amp;', 1) - instr (page_url, '=', 1)-1)
       					end page_id,create_user_name
			  from tbl_user_log_info t
			  where page_type='频道页'
			    and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 01:00:00','yyyy-mm-dd hh24:mi:ss')
			    and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 02:00:00','yyyy-mm-dd hh24:mi:ss')
			    and source_type = #{source_type,jdbcType=CHAR}
			    <choose>
				 	<when test="site_id !=null and site_id !=0">
				 		and site_id = #{site_id,jdbcType=INTEGER}
				 	</when>
				 	<when test="public_user_type != 1">
				 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
				 	</when>
				 	<otherwise></otherwise>
				 </choose>) a 
				 where length(a.page_id) = 8 group by page_id
				union all
           select '8888' page_id,'首页(系统)' page_name, count(distinct create_user_name) cnt,'02:00' create_date
             from tbl_user_log_info t
            where page_type='首页'
                  and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 01:00:00','yyyy-mm-dd hh24:mi:ss')
			      and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 02:00:00','yyyy-mm-dd hh24:mi:ss')
			      and source_type = #{source_type,jdbcType=CHAR}
				    <choose>
					 	<when test="site_id !=null and site_id !=0">
					 		and site_id = #{site_id,jdbcType=INTEGER}
					 	</when>
					 	<when test="public_user_type != 1">
					 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
					 	</when>
					 	<otherwise></otherwise>
					 </choose>
                group by page_name
			    union all
		select a.page_id,nvl((select page_name from tbl_decorate_page where id = a.page_id),0) page_name,count(distinct create_user_name) cnt,'03:00' create_date from
			(select case when instr (page_url, '&amp;', 1) = 0 then substr (page_url, instr (page_url, '=', 1) + 1, length (page_url)-1)
       					else substr (page_url, instr (page_url, '=', 1)+1, instr (page_url, '&amp;', 1) - instr (page_url, '=', 1)-1)
       					end page_id,create_user_name
			  from tbl_user_log_info t
			  where page_type='频道页'
			    and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 02:00:00','yyyy-mm-dd hh24:mi:ss')
			    and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 03:00:00','yyyy-mm-dd hh24:mi:ss')
			    and source_type = #{source_type,jdbcType=CHAR}
			    <choose>
				 	<when test="site_id !=null and site_id !=0">
				 		and site_id = #{site_id,jdbcType=INTEGER}
				 	</when>
				 	<when test="public_user_type != 1">
				 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
				 	</when>
				 	<otherwise></otherwise>
				 </choose>) a 
				 where length(a.page_id) = 8 group by page_id
				union all
           select '8888' page_id,'首页(系统)' page_name, count(distinct create_user_name) cnt,'03:00' create_date
             from tbl_user_log_info t
            where page_type='首页'
                  and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 02:00:00','yyyy-mm-dd hh24:mi:ss')
			      and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 03:00:00','yyyy-mm-dd hh24:mi:ss')
			      and source_type = #{source_type,jdbcType=CHAR}
				    <choose>
					 	<when test="site_id !=null and site_id !=0">
					 		and site_id = #{site_id,jdbcType=INTEGER}
					 	</when>
					 	<when test="public_user_type != 1">
					 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
					 	</when>
					 	<otherwise></otherwise>
					 </choose>
                group by page_name
			    union all
		select a.page_id,nvl((select page_name from tbl_decorate_page where id = a.page_id),0) page_name,count(distinct create_user_name) cnt,'04:00' create_date from
			(select case when instr (page_url, '&amp;', 1) = 0 then substr (page_url, instr (page_url, '=', 1) + 1, length (page_url)-1)
       					else substr (page_url, instr (page_url, '=', 1)+1, instr (page_url, '&amp;', 1) - instr (page_url, '=', 1)-1)
       					end page_id,create_user_name
			  from tbl_user_log_info t
			  where page_type='频道页'
			    and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 03:00:00','yyyy-mm-dd hh24:mi:ss')
			    and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 04:00:00','yyyy-mm-dd hh24:mi:ss')
			    and source_type = #{source_type,jdbcType=CHAR}
			    <choose>
				 	<when test="site_id !=null and site_id !=0">
				 		and site_id = #{site_id,jdbcType=INTEGER}
				 	</when>
				 	<when test="public_user_type != 1">
				 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
				 	</when>
				 	<otherwise></otherwise>
				 </choose>) a 
				 where length(a.page_id) = 8 group by page_id
				union all
           select '8888' page_id,'首页(系统)' page_name, count(distinct create_user_name) cnt,'04:00' create_date
             from tbl_user_log_info t
            where page_type='首页'
                  and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 03:00:00','yyyy-mm-dd hh24:mi:ss')
			      and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 04:00:00','yyyy-mm-dd hh24:mi:ss')
			      and source_type = #{source_type,jdbcType=CHAR}
				    <choose>
					 	<when test="site_id !=null and site_id !=0">
					 		and site_id = #{site_id,jdbcType=INTEGER}
					 	</when>
					 	<when test="public_user_type != 1">
					 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
					 	</when>
					 	<otherwise></otherwise>
					 </choose>
                group by page_name
			    union all
		select a.page_id,nvl((select page_name from tbl_decorate_page where id = a.page_id),0) page_name,count(distinct create_user_name) cnt,'05:00' create_date from
			(select case when instr (page_url, '&amp;', 1) = 0 then substr (page_url, instr (page_url, '=', 1) + 1, length (page_url)-1)
       					else substr (page_url, instr (page_url, '=', 1)+1, instr (page_url, '&amp;', 1) - instr (page_url, '=', 1)-1)
       					end page_id,create_user_name
			  from tbl_user_log_info t
			  where page_type='频道页'
			    and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 04:00:00','yyyy-mm-dd hh24:mi:ss')
			    and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 05:00:00','yyyy-mm-dd hh24:mi:ss')
			    and source_type = #{source_type,jdbcType=CHAR}
			    <choose>
				 	<when test="site_id !=null and site_id !=0">
				 		and site_id = #{site_id,jdbcType=INTEGER}
				 	</when>
				 	<when test="public_user_type != 1">
				 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
				 	</when>
				 	<otherwise></otherwise>
				 </choose>) a 
				 where length(a.page_id) = 8 group by page_id
				union all
           select '8888' page_id,'首页(系统)' page_name, count(distinct create_user_name) cnt,'05:00' create_date
             from tbl_user_log_info t
            where page_type='首页'
                  and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 04:00:00','yyyy-mm-dd hh24:mi:ss')
			      and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 05:00:00','yyyy-mm-dd hh24:mi:ss')
			      and source_type = #{source_type,jdbcType=CHAR}
				    <choose>
					 	<when test="site_id !=null and site_id !=0">
					 		and site_id = #{site_id,jdbcType=INTEGER}
					 	</when>
					 	<when test="public_user_type != 1">
					 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
					 	</when>
					 	<otherwise></otherwise>
					 </choose>
                group by page_name
			    union all
		select a.page_id,nvl((select page_name from tbl_decorate_page where id = a.page_id),0) page_name,count(distinct create_user_name) cnt,'06:00' create_date from
			(select case when instr (page_url, '&amp;', 1) = 0 then substr (page_url, instr (page_url, '=', 1) + 1, length (page_url)-1)
       					else substr (page_url, instr (page_url, '=', 1)+1, instr (page_url, '&amp;', 1) - instr (page_url, '=', 1)-1)
       					end page_id,create_user_name
			  from tbl_user_log_info t
			  where page_type='频道页'
			    and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 05:00:00','yyyy-mm-dd hh24:mi:ss')
			    and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 06:00:00','yyyy-mm-dd hh24:mi:ss')
			    and source_type = #{source_type,jdbcType=CHAR}
			    <choose>
				 	<when test="site_id !=null and site_id !=0">
				 		and site_id = #{site_id,jdbcType=INTEGER}
				 	</when>
				 	<when test="public_user_type != 1">
				 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
				 	</when>
				 	<otherwise></otherwise>
				 </choose>) a 
				 where length(a.page_id) = 8 group by page_id
				union all
           select '8888' page_id,'首页(系统)' page_name, count(distinct create_user_name) cnt,'06:00' create_date
             from tbl_user_log_info t
            where page_type='首页'
                  and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 05:00:00','yyyy-mm-dd hh24:mi:ss')
			      and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 06:00:00','yyyy-mm-dd hh24:mi:ss')
			      and source_type = #{source_type,jdbcType=CHAR}
				    <choose>
					 	<when test="site_id !=null and site_id !=0">
					 		and site_id = #{site_id,jdbcType=INTEGER}
					 	</when>
					 	<when test="public_user_type != 1">
					 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
					 	</when>
					 	<otherwise></otherwise>
					 </choose>
                group by page_name
			    union all
		select a.page_id,nvl((select page_name from tbl_decorate_page where id = a.page_id),0) page_name,count(distinct create_user_name) cnt,'07:00' create_date from
			(select case when instr (page_url, '&amp;', 1) = 0 then substr (page_url, instr (page_url, '=', 1) + 1, length (page_url)-1)
       					else substr (page_url, instr (page_url, '=', 1)+1, instr (page_url, '&amp;', 1) - instr (page_url, '=', 1)-1)
       					end page_id,create_user_name
			  from tbl_user_log_info t
			  where page_type='频道页'
			    and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 06:00:00','yyyy-mm-dd hh24:mi:ss')
			    and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 07:00:00','yyyy-mm-dd hh24:mi:ss')
			    and source_type = #{source_type,jdbcType=CHAR}
			    <choose>
				 	<when test="site_id !=null and site_id !=0">
				 		and site_id = #{site_id,jdbcType=INTEGER}
				 	</when>
				 	<when test="public_user_type != 1">
				 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
				 	</when>
				 	<otherwise></otherwise>
				 </choose>) a 
				 where length(a.page_id) = 8 group by page_id
				union all
           select '8888' page_id,'首页(系统)' page_name, count(distinct create_user_name) cnt,'07:00' create_date
             from tbl_user_log_info t
            where page_type='首页'
                  and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 06:00:00','yyyy-mm-dd hh24:mi:ss')
			      and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 07:00:00','yyyy-mm-dd hh24:mi:ss')
			      and source_type = #{source_type,jdbcType=CHAR}
				    <choose>
					 	<when test="site_id !=null and site_id !=0">
					 		and site_id = #{site_id,jdbcType=INTEGER}
					 	</when>
					 	<when test="public_user_type != 1">
					 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
					 	</when>
					 	<otherwise></otherwise>
					 </choose>
                group by page_name
			    union all
		select a.page_id,nvl((select page_name from tbl_decorate_page where id = a.page_id),0) page_name,count(distinct create_user_name) cnt,'08:00' create_date from
			(select case when instr (page_url, '&amp;', 1) = 0 then substr (page_url, instr (page_url, '=', 1) + 1, length (page_url)-1)
       					else substr (page_url, instr (page_url, '=', 1)+1, instr (page_url, '&amp;', 1) - instr (page_url, '=', 1)-1)
       					end page_id,create_user_name
			  from tbl_user_log_info t
			  where page_type='频道页'
			    and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 07:00:00','yyyy-mm-dd hh24:mi:ss')
			    and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 08:00:00','yyyy-mm-dd hh24:mi:ss')
			    and source_type = #{source_type,jdbcType=CHAR}
			    <choose>
				 	<when test="site_id !=null and site_id !=0">
				 		and site_id = #{site_id,jdbcType=INTEGER}
				 	</when>
				 	<when test="public_user_type != 1">
				 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
				 	</when>
				 	<otherwise></otherwise>
				 </choose>) a 
				 where length(a.page_id) = 8 group by page_id
				union all
           select '8888' page_id,'首页(系统)' page_name, count(distinct create_user_name) cnt,'08:00' create_date
             from tbl_user_log_info t
            where page_type='首页'
                  and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 07:00:00','yyyy-mm-dd hh24:mi:ss')
			      and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 08:00:00','yyyy-mm-dd hh24:mi:ss')
			      and source_type = #{source_type,jdbcType=CHAR}
				    <choose>
					 	<when test="site_id !=null and site_id !=0">
					 		and site_id = #{site_id,jdbcType=INTEGER}
					 	</when>
					 	<when test="public_user_type != 1">
					 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
					 	</when>
					 	<otherwise></otherwise>
					 </choose>
                group by page_name
			    union all
		select a.page_id,nvl((select page_name from tbl_decorate_page where id = a.page_id),0) page_name,count(distinct create_user_name) cnt,'09:00' create_date from
			(select case when instr (page_url, '&amp;', 1) = 0 then substr (page_url, instr (page_url, '=', 1) + 1, length (page_url)-1)
       					else substr (page_url, instr (page_url, '=', 1)+1, instr (page_url, '&amp;', 1) - instr (page_url, '=', 1)-1)
       					end page_id,create_user_name
			  from tbl_user_log_info t
			  where page_type='频道页'
			    and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 08:00:00','yyyy-mm-dd hh24:mi:ss')
			    and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 09:00:00','yyyy-mm-dd hh24:mi:ss')
			    and source_type = #{source_type,jdbcType=CHAR}
			    <choose>
				 	<when test="site_id !=null and site_id !=0">
				 		and site_id = #{site_id,jdbcType=INTEGER}
				 	</when>
				 	<when test="public_user_type != 1">
				 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
				 	</when>
				 	<otherwise></otherwise>
				 </choose>) a 
				 where length(a.page_id) = 8 group by page_id
				union all
           select '8888' page_id,'首页(系统)' page_name, count(distinct create_user_name) cnt,'09:00' create_date
             from tbl_user_log_info t
            where page_type='首页'
                  and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 08:00:00','yyyy-mm-dd hh24:mi:ss')
			      and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 09:00:00','yyyy-mm-dd hh24:mi:ss')
			      and source_type = #{source_type,jdbcType=CHAR}
				    <choose>
					 	<when test="site_id !=null and site_id !=0">
					 		and site_id = #{site_id,jdbcType=INTEGER}
					 	</when>
					 	<when test="public_user_type != 1">
					 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
					 	</when>
					 	<otherwise></otherwise>
					 </choose>
                group by page_name
			    union all
		select a.page_id,nvl((select page_name from tbl_decorate_page where id = a.page_id),0) page_name,count(distinct create_user_name) cnt,'10:00' create_date from
			(select case when instr (page_url, '&amp;', 1) = 0 then substr (page_url, instr (page_url, '=', 1) + 1, length (page_url)-1)
       					else substr (page_url, instr (page_url, '=', 1)+1, instr (page_url, '&amp;', 1) - instr (page_url, '=', 1)-1)
       					end page_id,create_user_name
			  from tbl_user_log_info t
			  where page_type='频道页'
			    and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 09:00:00','yyyy-mm-dd hh24:mi:ss')
			    and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 10:00:00','yyyy-mm-dd hh24:mi:ss')
			    and source_type = #{source_type,jdbcType=CHAR}
			    <choose>
				 	<when test="site_id !=null and site_id !=0">
				 		and site_id = #{site_id,jdbcType=INTEGER}
				 	</when>
				 	<when test="public_user_type != 1">
				 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
				 	</when>
				 	<otherwise></otherwise>
				 </choose>) a 
				 where length(a.page_id) = 8 group by page_id
				union all
           select '8888' page_id,'首页(系统)' page_name, count(distinct create_user_name) cnt,'10:00' create_date
             from tbl_user_log_info t
            where page_type='首页'
                  and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 09:00:00','yyyy-mm-dd hh24:mi:ss')
			      and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 10:00:00','yyyy-mm-dd hh24:mi:ss')
			      and source_type = #{source_type,jdbcType=CHAR}
				    <choose>
					 	<when test="site_id !=null and site_id !=0">
					 		and site_id = #{site_id,jdbcType=INTEGER}
					 	</when>
					 	<when test="public_user_type != 1">
					 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
					 	</when>
					 	<otherwise></otherwise>
					 </choose>
                group by page_name
			    union all
		select a.page_id,nvl((select page_name from tbl_decorate_page where id = a.page_id),0) page_name,count(distinct create_user_name) cnt,'11:00' create_date from
			(select case when instr (page_url, '&amp;', 1) = 0 then substr (page_url, instr (page_url, '=', 1) + 1, length (page_url)-1)
       					else substr (page_url, instr (page_url, '=', 1)+1, instr (page_url, '&amp;', 1) - instr (page_url, '=', 1)-1)
       					end page_id,create_user_name
			  from tbl_user_log_info t
			  where page_type='频道页'
			    and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 10:00:00','yyyy-mm-dd hh24:mi:ss')
			    and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 11:00:00','yyyy-mm-dd hh24:mi:ss')
			    and source_type = #{source_type,jdbcType=CHAR}
			    <choose>
				 	<when test="site_id !=null and site_id !=0">
				 		and site_id = #{site_id,jdbcType=INTEGER}
				 	</when>
				 	<when test="public_user_type != 1">
				 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
				 	</when>
				 	<otherwise></otherwise>
				 </choose>) a 
				 where length(a.page_id) = 8 group by page_id
				union all
           select '8888' page_id,'首页(系统)' page_name, count(distinct create_user_name) cnt,'11:00' create_date
             from tbl_user_log_info t
            where page_type='首页'
                  and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 10:00:00','yyyy-mm-dd hh24:mi:ss')
			      and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 11:00:00','yyyy-mm-dd hh24:mi:ss')
			      and source_type = #{source_type,jdbcType=CHAR}
				    <choose>
					 	<when test="site_id !=null and site_id !=0">
					 		and site_id = #{site_id,jdbcType=INTEGER}
					 	</when>
					 	<when test="public_user_type != 1">
					 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
					 	</when>
					 	<otherwise></otherwise>
					 </choose>
                group by page_name
			    union all
		select a.page_id,nvl((select page_name from tbl_decorate_page where id = a.page_id),0) page_name,count(distinct create_user_name) cnt,'12:00' create_date from
			(select case when instr (page_url, '&amp;', 1) = 0 then substr (page_url, instr (page_url, '=', 1) + 1, length (page_url)-1)
       					else substr (page_url, instr (page_url, '=', 1)+1, instr (page_url, '&amp;', 1) - instr (page_url, '=', 1)-1)
       					end page_id,create_user_name
			  from tbl_user_log_info t
			  where page_type='频道页'
			    and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 11:00:00','yyyy-mm-dd hh24:mi:ss')
			    and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 12:00:00','yyyy-mm-dd hh24:mi:ss')
			    and source_type = #{source_type,jdbcType=CHAR}
			    <choose>
				 	<when test="site_id !=null and site_id !=0">
				 		and site_id = #{site_id,jdbcType=INTEGER}
				 	</when>
				 	<when test="public_user_type != 1">
				 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
				 	</when>
				 	<otherwise></otherwise>
				 </choose>) a 
				 where length(a.page_id) = 8 group by page_id
				union all
           select '8888' page_id,'首页(系统)' page_name, count(distinct create_user_name) cnt,'12:00' create_date
             from tbl_user_log_info t
            where page_type='首页'
                  and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 11:00:00','yyyy-mm-dd hh24:mi:ss')
			      and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 12:00:00','yyyy-mm-dd hh24:mi:ss')
			      and source_type = #{source_type,jdbcType=CHAR}
				    <choose>
					 	<when test="site_id !=null and site_id !=0">
					 		and site_id = #{site_id,jdbcType=INTEGER}
					 	</when>
					 	<when test="public_user_type != 1">
					 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
					 	</when>
					 	<otherwise></otherwise>
					 </choose>
                group by page_name
			    union all
		select a.page_id,nvl((select page_name from tbl_decorate_page where id = a.page_id),0) page_name,count(distinct create_user_name) cnt,'13:00' create_date from
			(select case when instr (page_url, '&amp;', 1) = 0 then substr (page_url, instr (page_url, '=', 1) + 1, length (page_url)-1)
       					else substr (page_url, instr (page_url, '=', 1)+1, instr (page_url, '&amp;', 1) - instr (page_url, '=', 1)-1)
       					end page_id,create_user_name
			  from tbl_user_log_info t
			  where page_type='频道页'
			    and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 12:00:00','yyyy-mm-dd hh24:mi:ss')
			    and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 13:00:00','yyyy-mm-dd hh24:mi:ss')
			    and source_type = #{source_type,jdbcType=CHAR}
			    <choose>
				 	<when test="site_id !=null and site_id !=0">
				 		and site_id = #{site_id,jdbcType=INTEGER}
				 	</when>
				 	<when test="public_user_type != 1">
				 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
				 	</when>
				 	<otherwise></otherwise>
				 </choose>) a 
				 where length(a.page_id) = 8 group by page_id
				union all
           select '8888' page_id,'首页(系统)' page_name, count(distinct create_user_name) cnt,'13:00' create_date
             from tbl_user_log_info t
            where page_type='首页'
                  and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 12:00:00','yyyy-mm-dd hh24:mi:ss')
			      and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 13:00:00','yyyy-mm-dd hh24:mi:ss')
			      and source_type = #{source_type,jdbcType=CHAR}
				    <choose>
					 	<when test="site_id !=null and site_id !=0">
					 		and site_id = #{site_id,jdbcType=INTEGER}
					 	</when>
					 	<when test="public_user_type != 1">
					 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
					 	</when>
					 	<otherwise></otherwise>
					 </choose>
                group by page_name
			    union all
		select a.page_id,nvl((select page_name from tbl_decorate_page where id = a.page_id),0) page_name,count(distinct create_user_name) cnt,'14:00' create_date from
			(select case when instr (page_url, '&amp;', 1) = 0 then substr (page_url, instr (page_url, '=', 1) + 1, length (page_url)-1)
       					else substr (page_url, instr (page_url, '=', 1)+1, instr (page_url, '&amp;', 1) - instr (page_url, '=', 1)-1)
       					end page_id,create_user_name
			  from tbl_user_log_info t
			  where page_type='频道页'
			    and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 13:00:00','yyyy-mm-dd hh24:mi:ss')
			    and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 14:00:00','yyyy-mm-dd hh24:mi:ss')
			    and source_type = #{source_type,jdbcType=CHAR}
			    <choose>
				 	<when test="site_id !=null and site_id !=0">
				 		and site_id = #{site_id,jdbcType=INTEGER}
				 	</when>
				 	<when test="public_user_type != 1">
				 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
				 	</when>
				 	<otherwise></otherwise>
				 </choose>) a 
				 where length(a.page_id) = 8 group by page_id
				union all
           select '8888' page_id,'首页(系统)' page_name, count(distinct create_user_name) cnt,'14:00' create_date
             from tbl_user_log_info t
            where page_type='首页'
                  and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 13:00:00','yyyy-mm-dd hh24:mi:ss')
			      and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 14:00:00','yyyy-mm-dd hh24:mi:ss')
			      and source_type = #{source_type,jdbcType=CHAR}
				    <choose>
					 	<when test="site_id !=null and site_id !=0">
					 		and site_id = #{site_id,jdbcType=INTEGER}
					 	</when>
					 	<when test="public_user_type != 1">
					 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
					 	</when>
					 	<otherwise></otherwise>
					 </choose>
                group by page_name
			    union all
		select a.page_id,nvl((select page_name from tbl_decorate_page where id = a.page_id),0) page_name,count(distinct create_user_name) cnt,'15:00' create_date from
			(select case when instr (page_url, '&amp;', 1) = 0 then substr (page_url, instr (page_url, '=', 1) + 1, length (page_url)-1)
       					else substr (page_url, instr (page_url, '=', 1)+1, instr (page_url, '&amp;', 1) - instr (page_url, '=', 1)-1)
       					end page_id,create_user_name
			  from tbl_user_log_info t
			  where page_type='频道页'
			    and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 14:00:00','yyyy-mm-dd hh24:mi:ss')
			    and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 15:00:00','yyyy-mm-dd hh24:mi:ss')
			    and source_type = #{source_type,jdbcType=CHAR}
			    <choose>
				 	<when test="site_id !=null and site_id !=0">
				 		and site_id = #{site_id,jdbcType=INTEGER}
				 	</when>
				 	<when test="public_user_type != 1">
				 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
				 	</when>
				 	<otherwise></otherwise>
				 </choose>) a 
				 where length(a.page_id) = 8 group by page_id
				union all
           select '8888' page_id,'首页(系统)' page_name, count(distinct create_user_name) cnt,'15:00' create_date
             from tbl_user_log_info t
            where page_type='首页'
                  and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 14:00:00','yyyy-mm-dd hh24:mi:ss')
			      and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 15:00:00','yyyy-mm-dd hh24:mi:ss')
			      and source_type = #{source_type,jdbcType=CHAR}
				    <choose>
					 	<when test="site_id !=null and site_id !=0">
					 		and site_id = #{site_id,jdbcType=INTEGER}
					 	</when>
					 	<when test="public_user_type != 1">
					 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
					 	</when>
					 	<otherwise></otherwise>
					 </choose>
                group by page_name
			    union all
		select a.page_id,nvl((select page_name from tbl_decorate_page where id = a.page_id),0) page_name,count(distinct create_user_name) cnt,'16:00' create_date from
			(select case when instr (page_url, '&amp;', 1) = 0 then substr (page_url, instr (page_url, '=', 1) + 1, length (page_url)-1)
       					else substr (page_url, instr (page_url, '=', 1)+1, instr (page_url, '&amp;', 1) - instr (page_url, '=', 1)-1)
       					end page_id,create_user_name
			  from tbl_user_log_info t
			  where page_type='频道页'
			    and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 15:00:00','yyyy-mm-dd hh24:mi:ss')
			    and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 16:00:00','yyyy-mm-dd hh24:mi:ss')
			    and source_type = #{source_type,jdbcType=CHAR}
			    <choose>
				 	<when test="site_id !=null and site_id !=0">
				 		and site_id = #{site_id,jdbcType=INTEGER}
				 	</when>
				 	<when test="public_user_type != 1">
				 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
				 	</when>
				 	<otherwise></otherwise>
				 </choose>) a 
				 where length(a.page_id) = 8 group by page_id
				union all
           select '8888' page_id,'首页(系统)' page_name, count(distinct create_user_name) cnt,'16:00' create_date
             from tbl_user_log_info t
            where page_type='首页'
                  and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 15:00:00','yyyy-mm-dd hh24:mi:ss')
			      and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 16:00:00','yyyy-mm-dd hh24:mi:ss')
			      and source_type = #{source_type,jdbcType=CHAR}
				    <choose>
					 	<when test="site_id !=null and site_id !=0">
					 		and site_id = #{site_id,jdbcType=INTEGER}
					 	</when>
					 	<when test="public_user_type != 1">
					 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
					 	</when>
					 	<otherwise></otherwise>
					 </choose>
                group by page_name
			    union all
		select a.page_id,nvl((select page_name from tbl_decorate_page where id = a.page_id),0) page_name,count(distinct create_user_name) cnt,'17:00' create_date from
			(select case when instr (page_url, '&amp;', 1) = 0 then substr (page_url, instr (page_url, '=', 1) + 1, length (page_url)-1)
       					else substr (page_url, instr (page_url, '=', 1)+1, instr (page_url, '&amp;', 1) - instr (page_url, '=', 1)-1)
       					end page_id,create_user_name
			  from tbl_user_log_info t
			  where page_type='频道页'
			    and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 16:00:00','yyyy-mm-dd hh24:mi:ss')
			    and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 17:00:00','yyyy-mm-dd hh24:mi:ss')
			    and source_type = #{source_type,jdbcType=CHAR}
			    <choose>
				 	<when test="site_id !=null and site_id !=0">
				 		and site_id = #{site_id,jdbcType=INTEGER}
				 	</when>
				 	<when test="public_user_type != 1">
				 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
				 	</when>
				 	<otherwise></otherwise>
				 </choose>) a 
				 where length(a.page_id) = 8 group by page_id
				union all
           select '8888' page_id,'首页(系统)' page_name, count(distinct create_user_name) cnt,'17:00' create_date
             from tbl_user_log_info t
            where page_type='首页'
                  and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 16:00:00','yyyy-mm-dd hh24:mi:ss')
			      and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 17:00:00','yyyy-mm-dd hh24:mi:ss')
			      and source_type = #{source_type,jdbcType=CHAR}
				    <choose>
					 	<when test="site_id !=null and site_id !=0">
					 		and site_id = #{site_id,jdbcType=INTEGER}
					 	</when>
					 	<when test="public_user_type != 1">
					 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
					 	</when>
					 	<otherwise></otherwise>
					 </choose>
                group by page_name
			    union all
		select a.page_id,nvl((select page_name from tbl_decorate_page where id = a.page_id),0) page_name,count(distinct create_user_name) cnt,'18:00' create_date from
			(select case when instr (page_url, '&amp;', 1) = 0 then substr (page_url, instr (page_url, '=', 1) + 1, length (page_url)-1)
       					else substr (page_url, instr (page_url, '=', 1)+1, instr (page_url, '&amp;', 1) - instr (page_url, '=', 1)-1)
       					end page_id,create_user_name
			  from tbl_user_log_info t
			  where page_type='频道页'
			    and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 17:00:00','yyyy-mm-dd hh24:mi:ss')
			    and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 18:00:00','yyyy-mm-dd hh24:mi:ss')
			    and source_type = #{source_type,jdbcType=CHAR}
			    <choose>
				 	<when test="site_id !=null and site_id !=0">
				 		and site_id = #{site_id,jdbcType=INTEGER}
				 	</when>
				 	<when test="public_user_type != 1">
				 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
				 	</when>
				 	<otherwise></otherwise>
				 </choose>) a 
				 where length(a.page_id) = 8 group by page_id
				union all
           select '8888' page_id,'首页(系统)' page_name, count(distinct create_user_name) cnt,'18:00' create_date
             from tbl_user_log_info t
            where page_type='首页'
                  and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 17:00:00','yyyy-mm-dd hh24:mi:ss')
			      and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 18:00:00','yyyy-mm-dd hh24:mi:ss')
			      and source_type = #{source_type,jdbcType=CHAR}
				    <choose>
					 	<when test="site_id !=null and site_id !=0">
					 		and site_id = #{site_id,jdbcType=INTEGER}
					 	</when>
					 	<when test="public_user_type != 1">
					 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
					 	</when>
					 	<otherwise></otherwise>
					 </choose>
                group by page_name
			    union all
		select a.page_id,nvl((select page_name from tbl_decorate_page where id = a.page_id),0) page_name,count(distinct create_user_name) cnt,'19:00' create_date from
			(select case when instr (page_url, '&amp;', 1) = 0 then substr (page_url, instr (page_url, '=', 1) + 1, length (page_url)-1)
       					else substr (page_url, instr (page_url, '=', 1)+1, instr (page_url, '&amp;', 1) - instr (page_url, '=', 1)-1)
       					end page_id,create_user_name
			  from tbl_user_log_info t
			  where page_type='频道页'
			    and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 18:00:00','yyyy-mm-dd hh24:mi:ss')
			    and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 19:00:00','yyyy-mm-dd hh24:mi:ss')
			    and source_type = #{source_type,jdbcType=CHAR}
			    <choose>
				 	<when test="site_id !=null and site_id !=0">
				 		and site_id = #{site_id,jdbcType=INTEGER}
				 	</when>
				 	<when test="public_user_type != 1">
				 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
				 	</when>
				 	<otherwise></otherwise>
				 </choose>) a 
				 where length(a.page_id) = 8 group by page_id
				union all
           select '8888' page_id,'首页(系统)' page_name, count(distinct create_user_name) cnt,'19:00' create_date
             from tbl_user_log_info t
            where page_type='首页'
                  and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 18:00:00','yyyy-mm-dd hh24:mi:ss')
			      and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 19:00:00','yyyy-mm-dd hh24:mi:ss')
			      and source_type = #{source_type,jdbcType=CHAR}
				    <choose>
					 	<when test="site_id !=null and site_id !=0">
					 		and site_id = #{site_id,jdbcType=INTEGER}
					 	</when>
					 	<when test="public_user_type != 1">
					 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
					 	</when>
					 	<otherwise></otherwise>
					 </choose>
                group by page_name
			    union all
		select a.page_id,nvl((select page_name from tbl_decorate_page where id = a.page_id),0) page_name,count(distinct create_user_name) cnt,'20:00' create_date from
			(select case when instr (page_url, '&amp;', 1) = 0 then substr (page_url, instr (page_url, '=', 1) + 1, length (page_url)-1)
       					else substr (page_url, instr (page_url, '=', 1)+1, instr (page_url, '&amp;', 1) - instr (page_url, '=', 1)-1)
       					end page_id,create_user_name
			  from tbl_user_log_info t
			  where page_type='频道页'
			    and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 19:00:00','yyyy-mm-dd hh24:mi:ss')
			    and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 20:00:00','yyyy-mm-dd hh24:mi:ss')
			    and source_type = #{source_type,jdbcType=CHAR}
			    <choose>
				 	<when test="site_id !=null and site_id !=0">
				 		and site_id = #{site_id,jdbcType=INTEGER}
				 	</when>
				 	<when test="public_user_type != 1">
				 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
				 	</when>
				 	<otherwise></otherwise>
				 </choose>) a 
				 where length(a.page_id) = 8 group by page_id
				union all
           select '8888' page_id,'首页(系统)' page_name, count(distinct create_user_name) cnt,'20:00' create_date
             from tbl_user_log_info t
            where page_type='首页'
                  and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 19:00:00','yyyy-mm-dd hh24:mi:ss')
			      and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 20:00:00','yyyy-mm-dd hh24:mi:ss')
			      and source_type = #{source_type,jdbcType=CHAR}
				    <choose>
					 	<when test="site_id !=null and site_id !=0">
					 		and site_id = #{site_id,jdbcType=INTEGER}
					 	</when>
					 	<when test="public_user_type != 1">
					 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
					 	</when>
					 	<otherwise></otherwise>
					 </choose>
                group by page_name
			    union all
		select a.page_id,nvl((select page_name from tbl_decorate_page where id = a.page_id),0) page_name,count(distinct create_user_name) cnt,'21:00' create_date from
			(select case when instr (page_url, '&amp;', 1) = 0 then substr (page_url, instr (page_url, '=', 1) + 1, length (page_url)-1)
       					else substr (page_url, instr (page_url, '=', 1)+1, instr (page_url, '&amp;', 1) - instr (page_url, '=', 1)-1)
       					end page_id,create_user_name
			  from tbl_user_log_info t
			  where page_type='频道页'
			    and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 20:00:00','yyyy-mm-dd hh24:mi:ss')
			    and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 21:00:00','yyyy-mm-dd hh24:mi:ss')
			    and source_type = #{source_type,jdbcType=CHAR}
			    <choose>
				 	<when test="site_id !=null and site_id !=0">
				 		and site_id = #{site_id,jdbcType=INTEGER}
				 	</when>
				 	<when test="public_user_type != 1">
				 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
				 	</when>
				 	<otherwise></otherwise>
				 </choose>) a 
				 where length(a.page_id) = 8 group by page_id
				union all
           select '8888' page_id,'首页(系统)' page_name, count(distinct create_user_name) cnt,'21:00' create_date
             from tbl_user_log_info t
            where page_type='首页'
                  and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 20:00:00','yyyy-mm-dd hh24:mi:ss')
			      and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 21:00:00','yyyy-mm-dd hh24:mi:ss')
			      and source_type = #{source_type,jdbcType=CHAR}
				    <choose>
					 	<when test="site_id !=null and site_id !=0">
					 		and site_id = #{site_id,jdbcType=INTEGER}
					 	</when>
					 	<when test="public_user_type != 1">
					 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
					 	</when>
					 	<otherwise></otherwise>
					 </choose>
                group by page_name
			    union all
		select a.page_id,nvl((select page_name from tbl_decorate_page where id = a.page_id),0) page_name,count(distinct create_user_name) cnt,'22:00' create_date from
			(select case when instr (page_url, '&amp;', 1) = 0 then substr (page_url, instr (page_url, '=', 1) + 1, length (page_url)-1)
       					else substr (page_url, instr (page_url, '=', 1)+1, instr (page_url, '&amp;', 1) - instr (page_url, '=', 1)-1)
       					end page_id,create_user_name
			  from tbl_user_log_info t
			  where page_type='频道页'
			    and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 21:00:00','yyyy-mm-dd hh24:mi:ss')
			    and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 22:00:00','yyyy-mm-dd hh24:mi:ss')
			    and source_type = #{source_type,jdbcType=CHAR}
			    <choose>
				 	<when test="site_id !=null and site_id !=0">
				 		and site_id = #{site_id,jdbcType=INTEGER}
				 	</when>
				 	<when test="public_user_type != 1">
				 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
				 	</when>
				 	<otherwise></otherwise>
				 </choose>) a 
				 where length(a.page_id) = 8 group by page_id
				union all
           select '8888' page_id,'首页(系统)' page_name, count(distinct create_user_name) cnt,'22:00' create_date
             from tbl_user_log_info t
            where page_type='首页'
                  and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 21:00:00','yyyy-mm-dd hh24:mi:ss')
			      and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 22:00:00','yyyy-mm-dd hh24:mi:ss')
			      and source_type = #{source_type,jdbcType=CHAR}
				    <choose>
					 	<when test="site_id !=null and site_id !=0">
					 		and site_id = #{site_id,jdbcType=INTEGER}
					 	</when>
					 	<when test="public_user_type != 1">
					 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
					 	</when>
					 	<otherwise></otherwise>
					 </choose>
                group by page_name
			    union all
		select a.page_id,nvl((select page_name from tbl_decorate_page where id = a.page_id),0) page_name,count(distinct create_user_name) cnt,'23:00' create_date from
			(select case when instr (page_url, '&amp;', 1) = 0 then substr (page_url, instr (page_url, '=', 1) + 1, length (page_url)-1)
       					else substr (page_url, instr (page_url, '=', 1)+1, instr (page_url, '&amp;', 1) - instr (page_url, '=', 1)-1)
       					end page_id,create_user_name
			  from tbl_user_log_info t
			  where page_type='频道页'
			    and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 22:00:00','yyyy-mm-dd hh24:mi:ss')
			    and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 23:00:00','yyyy-mm-dd hh24:mi:ss')
			    and source_type = #{source_type,jdbcType=CHAR}
			    <choose>
				 	<when test="site_id !=null and site_id !=0">
				 		and site_id = #{site_id,jdbcType=INTEGER}
				 	</when>
				 	<when test="public_user_type != 1">
				 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
				 	</when>
				 	<otherwise></otherwise>
				 </choose>) a 
				 where length(a.page_id) = 8 group by page_id
				union all
           select '8888' page_id,'首页(系统)' page_name, count(distinct create_user_name) cnt,'23:00' create_date
             from tbl_user_log_info t
            where page_type='首页'
                  and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 22:00:00','yyyy-mm-dd hh24:mi:ss')
			      and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 23:00:00','yyyy-mm-dd hh24:mi:ss')
			      and source_type = #{source_type,jdbcType=CHAR}
				    <choose>
					 	<when test="site_id !=null and site_id !=0">
					 		and site_id = #{site_id,jdbcType=INTEGER}
					 	</when>
					 	<when test="public_user_type != 1">
					 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
					 	</when>
					 	<otherwise></otherwise>
					 </choose>
                group by page_name
			    union all
		select a.page_id,nvl((select page_name from tbl_decorate_page where id = a.page_id),0) page_name,count(distinct create_user_name) cnt,'24:00' create_date from
			(select case when instr (page_url, '&amp;', 1) = 0 then substr (page_url, instr (page_url, '=', 1) + 1, length (page_url)-1)
       					else substr (page_url, instr (page_url, '=', 1)+1, instr (page_url, '&amp;', 1) - instr (page_url, '=', 1)-1)
       					end page_id,create_user_name
			  from tbl_user_log_info t
			  where page_type='频道页'
			    and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 23:00:00','yyyy-mm-dd hh24:mi:ss')
			    and create_date &lt;= to_date(to_char(sysdate,'yyyy-mm-dd')||' 23:59:59','yyyy-mm-dd hh24:mi:ss')
			    and source_type = #{source_type,jdbcType=CHAR}
			    <choose>
				 	<when test="site_id !=null and site_id !=0">
				 		and site_id = #{site_id,jdbcType=INTEGER}
				 	</when>
				 	<when test="public_user_type != 1">
				 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
				 	</when>
				 	<otherwise></otherwise>
				 </choose>) a 
				 where length(a.page_id) = 8 group by page_id
				 union all
           select '8888' page_id,'首页(系统)' page_name, count(distinct create_user_name) cnt,'24:00' create_date
             from tbl_user_log_info t
            where page_type='首页'
                  and create_date >= to_date(to_char(sysdate,'yyyy-mm-dd')||' 23:00:00','yyyy-mm-dd hh24:mi:ss')
			      and create_date &lt; to_date(to_char(sysdate,'yyyy-mm-dd')||' 23:59:59','yyyy-mm-dd hh24:mi:ss')
			      and source_type = #{source_type,jdbcType=CHAR}
				    <choose>
					 	<when test="site_id !=null and site_id !=0">
					 		and site_id = #{site_id,jdbcType=INTEGER}
					 	</when>
					 	<when test="public_user_type != 1">
					 		and exists (select 1 from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER} and site_id = t.site_id)
					 	</when>
					 	<otherwise></otherwise>
					 </choose>
                group by page_name) b
		where 1=1
		   <if test="site_id !=null and site_id !=0">
			  and exists (select 1 from tbl_decorate_page c where c.site_id = #{site_id,jdbcType=INTEGER} and c.id = b.page_id and exists (select 1 from tbl_decorate_template where id = c.template_id and support_flag = #{source_type,jdbcType=CHAR}))
		   </if>		 
  	</select>
  	<!--**********************************以下代码为品牌统计相关    add for wangpeng 2018-01-11 ************begin*********************** -->
  	<!-- 品牌统计数据-所有支付金额 -->
  	<select id="queryBrandData_AllPayMoney" parameterType="java.util.Map" resultType="java.lang.Float">
  		<if test="brand_id !=null and brand_id !=0">
  			select nvl(sum(PRODUCT_TOTAL_MONEY),0) from TBL_ORDER_PRODUCT a ,TBL_ORDER_INFO b
			where a.order_number = b.order_number and b.PAYMENT_STATE = 2
  		</if>
  		<if test="brand_id ==null or brand_id ==0">
  			select nvl(sum(PRODUCT_money+df_money+LOGISTICS_MONEY),0) from TBL_ORDER_INFO b
			where b.PAYMENT_STATE = 2
  		</if>
		
		--判断时间筛选
		and b.PAYMENT_DATE >= to_date(#{start_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
		and b.PAYMENT_DATE &lt;= to_date(#{end_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
		<if test="brand_id !=null and brand_id !=0">
			and exists
			(
			   select 1 from tbl_product_info c where a.ITEMNUMBER = c.ITEMNUMBER and c.BRAND_ID =  #{brand_id,jdbcType=INTEGER}
			)
		</if>
		<if test="site_id !=null and site_id !=0">
			and exists
			(
			    select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = b.user_name
			)
		</if>
		<if test="public_user_type != 1">
	 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = b.user_name)
	 	</if>
  	</select>
  	
  	<!-- 品牌统计数据-预订支付的首款 -->
  	<select id="queryBrandData_PreFirstMoney" parameterType="java.util.Map" resultType="java.lang.Float">
  		select nvl(sum(a.PRODUCT_MONEY*(b.EARNEST_MONEY/b.PRODUCT_MONEY)),0) from TBL_PRE_ORDER_DETAIL a ,TBL_PRE_ORDER_INFO b
		where a.order_number = b.order_number and b.PAYMENT_STATE = 2
		--判断时间筛选
		and b.PAYMENT_DATE >= to_date(#{start_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
		and b.PAYMENT_DATE &lt;= to_date(#{end_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
		<if test="brand_id !=null and brand_id !=0">
			and exists
			(
			   select 1 from tbl_product_info c where a.PRODUCT_ITEMNUMBER = c.ITEMNUMBER and c.BRAND_ID =  #{brand_id,jdbcType=INTEGER}
			)
		</if>
		<if test="site_id !=null and site_id !=0">
			and exists
			(
			    select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = a.user_id
			)
		</if>
		<if test="public_user_type != 1">
	 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = a.user_id)
	 	</if>
  	</select>
  	
  	<!-- 品牌统计数据-尾款订单的定金金额 -->
  	<select id="queryBrandData_PreOrderFirstMoney" parameterType="java.util.Map" resultType="java.lang.Float">
  		select nvl(sum(a.PRODUCT_TOTAL_MONEY*(g.EARNEST_MONEY/g.PRODUCT_MONEY)),0) from TBL_ORDER_PRODUCT a ,TBL_ORDER_INFO b,TBL_PRE_ORDER_RELATE f,TBL_PRE_ORDER_INFO g
		where a.order_number = f.order_number and f.PRE_ORDER_NUMBER = g.ORDER_NUMBER
		and a.order_number = b.order_number and b.PAYMENT_STATE = 2
		--判断时间筛选
		and b.PAYMENT_DATE >= to_date(#{start_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
		and b.PAYMENT_DATE &lt;= to_date(#{end_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
		<if test="brand_id !=null and brand_id !=0">
			and exists
			(
			   select 1 from tbl_product_info c where a.ITEMNUMBER = c.ITEMNUMBER and c.BRAND_ID =  #{brand_id,jdbcType=INTEGER}
			)
		</if>
		<if test="site_id !=null and site_id !=0">
			and exists
			(
			    select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = a.user_name
			)
		</if>
		<if test="public_user_type != 1">
	 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = a.user_name)
	 	</if>
  	</select>
  	
  	<!-- 品牌统计数据-商品访客人数 -->
  	<select id="queryBrandData_VisitorCount" parameterType="java.util.Map" resultType="java.lang.Float">
  		select count(*) from (
		    select distinct create_user_name from tbl_user_log_info b
		    where 
		    --判断时间筛选
		    b.create_date >= to_date(#{start_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
		    and b.create_date &lt;= to_date(#{end_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
		    <if test="brand_id !=null and brand_id !=0">
		    	and page_type = '商品详情'
			    and exists
			    (
			       select 1 from tbl_product_info c where b.PAGE_NAME = c.ITEMNUMBER and c.BRAND_ID =  #{brand_id,jdbcType=INTEGER}
			    )
		    </if>
		    <if test="site_id !=null and site_id !=0">
			    and exists
			    (
			        select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = b.CREATE_USER_NAME
			    )
		    </if>
		    <if test="public_user_type != 1">
		 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = b.CREATE_USER_NAME)
		 	</if>
		)
  	</select>
  	
  	<!-- 品牌统计数据-购买的人数和总单数 -->
  	<select id="queryBrandData_PurchaseNumberOrderCount" parameterType="java.util.Map" resultType="java.util.Map">
  		select count(*) purchaseNumber,nvl(sum(order_count),0) orderCount  from (
		    select user_name,count(*) order_count from TBL_ORDER_INFO b
		    where b.PAYMENT_STATE = 2
		    --判断时间筛选
		    and b.PAYMENT_DATE >= to_date(#{start_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
		    and b.PAYMENT_DATE &lt;= to_date(#{end_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
		    <if test="brand_id !=null and brand_id !=0">
			    and exists
			    (
			       select 1 from TBL_ORDER_PRODUCT a,tbl_product_info c where a.ITEMNUMBER = c.ITEMNUMBER and a.order_number = b.order_number and c.BRAND_ID =  #{brand_id,jdbcType=INTEGER}
			    )
		    </if>
		    <if test="site_id !=null and site_id !=0">
		    	and exists
			    (
			        select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = b.user_name
			    )
		    </if>
		    <if test="public_user_type != 1">
		 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = b.user_name)
		 	</if>
		    group by user_name
		)
  	</select>
  	
  	<!-- 品牌统计数据-仅退款金额 -->
  	<select id="queryBrandData_OnlyReturnMoney" parameterType="java.util.Map" resultType="java.lang.Float">
  		select nvl(sum(PRODUCT_TOTAL_MONEY),0) from TBL_ORDER_RETURN_PRODUCT a ,TBL_ORDER_RETURN_INFO b
		where a.RETURN_NUMBER = b.RETURN_NUMBER and b.state = 2
		--判断时间筛选
		and b.CHECK_DATE >= to_date(#{start_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
		and b.CHECK_DATE &lt;= to_date(#{end_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
		<if test="brand_id !=null and brand_id !=0">
			and exists
			(
			   select 1 from tbl_product_info c where a.PRODUCT_ITEMNUMBER = c.ITEMNUMBER and c.BRAND_ID =  #{brand_id,jdbcType=INTEGER}
			)
		</if>
		<if test="site_id !=null and site_id !=0">
			and exists
			(
			    select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = a.user_name
			)
		</if>
		<if test="public_user_type != 1">
	 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = a.user_name)
	 	</if>
  	</select>
  	
  	<!-- 品牌统计数据-售后退款-->
  	<select id="queryBrandData_AfterSaleReturnMoney" parameterType="java.util.Map" resultType="java.lang.Float">
  		select nvl(sum(RETURN_MONEY),0)
		from ${jdbc_user}.tbl_new_return_confirm a,${jdbc_user}.tbl_new_return_order b,tbl_product_sku c
		where a.product_sku = c.ID and a.RETURN_NUMBER = b.RETURN_NUMBER and b.state = '8'
		--判断时间筛选
		and b.refund_date >= to_date(#{start_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
		and b.refund_date &lt;= to_date(#{end_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
		<if test="brand_id !=null and brand_id !=0">
			and exists
			(
			   select 1 from tbl_product_info f where c.PRODUCT_ITEMNUMBER = f.ITEMNUMBER and f.BRAND_ID =  #{brand_id,jdbcType=INTEGER}
			)
		</if>
		<if test="site_id !=null and site_id !=0">
			and exists
			(
			    select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = b.user_name
			)
		</if>
		<if test="public_user_type != 1">
	 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = b.user_name)
	 	</if>
  	</select>
  	
  	<!-- 品牌统计数据-总成交商品数-->
  	<select id="queryBrandData_SaleCount" parameterType="java.util.Map" resultType="java.lang.Float">
  		select nvl(sum(a.product_count),0) product_sumcount from TBL_ORDER_PRODUCT a,TBL_ORDER_INFO b
		where b.PAYMENT_STATE = 2 and a.order_number = b.order_number
		--判断时间筛选
		and b.PAYMENT_DATE >= to_date(#{start_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
		and b.PAYMENT_DATE &lt;= to_date(#{end_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
		<if test="brand_id !=null and brand_id !=0">
			and exists
			(
			   select 1 from tbl_product_info c where a.ITEMNUMBER = c.ITEMNUMBER  and c.BRAND_ID =  #{brand_id,jdbcType=INTEGER}
			)
		</if>
		<if test="site_id !=null and site_id !=0">
			and exists
			(
			    select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = b.user_name
			)
		</if>
		<if test="public_user_type != 1">
	 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = b.user_name)
	 	</if>
  	</select>
  	<!--**********************************以上代码为品牌统计相关    add for wangpeng 2018-01-11 ************end*********************** -->
  	
  	
  	
  	
  	<!-- 品牌数据  该方法废弃-->
  	<select id="queryBrandData" parameterType="java.util.Map" resultType="java.util.Map">
		select order_count,
		       product_count,
		       product_money,
		       visitor_count,
		       nvl(return_money,0) return_money,
		       case
		          when product_money = 0 then 0
		          when visitor_count = 0 then 0
		          else round (product_money / visitor_count, 2)
		       end
		          visitor_unit_price,
		       case
		          when visitor_order_count = 0 then 0
		          when visitor_count = 0 then 0
		          else round (visitor_order_count / visitor_count * 100, 2)
		       end
		          conversion_ratio
		  from (select product_count,
		               product_money,
		               (select sum(order_count) order_count from (
		               select count(t1.order_number) order_count
				          from tbl_order_info t,(select order_number
		                    						 from tbl_order_product temp
							                          where exists
								                        (select 1
								                           from tbl_product_info pi
								                          where     exists
								                                       (select 1
								                                          from tbl_dic_product_brand
								                                         where     state = '2'
								                                               and id = pi.brand_id
								                                               <if test="brand_id !=null and brand_id !=0">
											                                     and id = #{brand_id,jdbcType=INTEGER}
											                                   </if>)
							                                and itemnumber = temp.itemnumber)
				                                group by order_number) t1
				             where     t.create_date >= to_date(#{start_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
					               and t.create_date &lt;= to_date(#{end_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
				                   and t.order_state in (2,3,5)
				                   and t.order_number = t1.order_number(+)
				                  <choose>
								 	<when test="site_id !=null and site_id !=0">
								 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = t.user_name)
								 	</when>
								 	<when test="public_user_type != 1">
								 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = t.user_name)
								 	</when>
								 	<otherwise></otherwise>
								 </choose>
						  union all
				        select count(t1.order_number) order_count
				          from tbl_pre_order_info t,
				                    (select order_number
				                        from tbl_pre_order_detail temp
				                      where place_state = '1'
				                        and exists
				                        (select 1
				                           from tbl_product_info pi
				                          where     exists
				                                       (select 1
				                                          from tbl_dic_product_brand
				                                         where     state = '2'
				                                               and id = pi.brand_id
				                                               <if test="brand_id !=null and brand_id !=0">
							                                     and id = #{brand_id,jdbcType=INTEGER}
							                                   </if>)
				                                and itemnumber = temp.product_itemnumber)
				                              group by order_number) t1
				         			where    t.create_date >= to_date(#{start_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
						                 and t.create_date &lt;= to_date(#{end_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
				                         and t.order_state in (2,3)
				                         and t.order_number = t1.order_number(+)
				                         <choose>
										 	<when test="site_id !=null and site_id !=0">
										 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and id = t.user_id)
										 	</when>
										 	<when test="public_user_type != 1">
										 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and id = t.user_id)
										 	</when>
										 	<otherwise></otherwise>
										 </choose>)
		               ) order_count,
		                (  select count (distinct create_user_name)
		                            from tbl_user_log_info temp
		                           where     create_date >= to_date(#{start_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
		                                 and create_date &lt;= to_date(#{end_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
		                                 and page_type = '商品详情'
		                                 and exists
		                                        (select itemnumber
		                                           from tbl_product_info pi
		                                          where     exists
		                                                       (select 1
		                                                          from tbl_dic_product_brand
		                                                         where     state = '2'
		                                                               and id = pi.brand_id
		                                                               <if test="brand_id !=null and brand_id !=0">
									                                     and id = #{brand_id,jdbcType=INTEGER}
									                                   </if>)
		                                                and itemnumber = temp.page_name)
		                                                <choose>
														 	<when test="site_id !=null and site_id !=0">
														 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = temp.create_user_name)
														 	</when>
														 	<when test="public_user_type != 1">
														 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = temp.create_user_name)
														 	</when>
														 	<otherwise></otherwise>
														 </choose>)
		                  visitor_count,
		               (select count (distinct create_user_name)
		                  from tbl_user_log_info temp
		                 where     create_date >= to_date(#{start_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
		                       and create_date &lt;= to_date(#{end_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
		                       and page_type = '商品详情'
		                       and exists
		                              (select itemnumber
		                                 from tbl_product_info pi
		                                where     exists
		                                             (select 1
		                                                from tbl_dic_product_brand
		                                               where     state = '2'
		                                                     and id = pi.brand_id
		                                                     <if test="brand_id !=null and brand_id !=0">
							                                    and id = #{brand_id,jdbcType=INTEGER}
							                                 </if>)
		                                      and itemnumber = temp.page_name)
		                       and not exists
		                                  (select user_name
		                                     from tbl_order_info t
		                                    where     create_date >= to_date(#{start_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
		                                          and create_date &lt;= to_date(#{end_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
		                                          and order_state in (2,3,5)
		                                          and user_name = temp.create_user_name)
		                       and not exists
                                    (select user_id
                                       from tbl_pre_order_info 
                                      where  create_date >= to_date(#{start_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
		                                     and create_date &lt;= to_date(#{end_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
                                             and order_state in (2,3)
                                             and user_id = temp.create_user_name)
	                                                 <choose>
													 	<when test="site_id !=null and site_id !=0">
													 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = temp.create_user_name)
													 	</when>
													 	<when test="public_user_type != 1">
													 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = temp.create_user_name)
													 	</when>
													 	<otherwise></otherwise>
													 </choose>)
		                  visitor_order_count,
		               (select   nvl((select sum (temp2.product_money)
				            from tbl_order_return_info temp,
				            	 (select return_number,sum(product_total_money) product_money
                                           from tbl_order_return_product t
                                          where exists
                                                   (select 1
                                                      from tbl_product_info pi
                                                     where     exists
                                                                  (select 1
                                                                     from tbl_dic_product_brand
                                                                    where     state = '2'
                                                                          and id = pi.brand_id
                                                                          <if test="brand_id !=null and brand_id !=0">
										                                     and id = #{brand_id,jdbcType=INTEGER}
									                                      </if>)
                                                           and itemnumber = t.product_itemnumber)
                                                           group by return_number) temp2
				           where     temp.state = '2'
				                 and temp.check_date >= to_date(#{start_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
				                 and temp.check_date &lt;= to_date(#{end_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
				                 and temp.return_number = temp2.return_number(+)
				                <choose>
								 	<when test="site_id !=null and site_id !=0">
								 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = temp.user_name)
								 	</when>
								 	<when test="public_user_type != 1">
								 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = temp.user_name)
								 	</when>
								 	<otherwise></otherwise>
								 </choose>),0)
				       + nvl((select sum (temp2.return_money) return_money
				               from ${jdbc_user}.tbl_new_return_order temp,
				               		(select return_number, sum (return_money) return_money
						              from ${jdbc_user}.tbl_new_return_confirm t
						             where exists
				                          (select 1
				                             from tbl_product_sku ps
				                            where     exists
				                                         (select 1
				                                            from tbl_product_info pi
			                                               where exists
			                                                        (select 1
			                                                           from tbl_dic_product_brand
			                                                          where     state = '2'
			                                                                and id = pi.brand_id
			                                                                <if test="brand_id !=null and brand_id !=0">
											                                     and id = #{brand_id,jdbcType=INTEGER}
											                                 </if>)
				                                             and itemnumber = ps.product_itemnumber)
				                                  and product_group = '尺码'
				                                  and id = t.product_sku)
						                and return_flag = 1
						                and delete_flag = 0
						          group by return_number) temp2
				              where     temp.state = '8'
				                    and temp.refund_date >= to_date(#{start_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
				                    and temp.refund_date &lt;= to_date(#{end_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
				                    and temp.return_number = temp2.return_number(+)
			                <choose>
							 	<when test="site_id !=null and site_id !=0">
							 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = temp.user_name)
							 	</when>
							 	<when test="public_user_type != 1">
							 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = temp.user_name)
							 	</when>
							 	<otherwise></otherwise>
							 </choose>),0)
				  from dual)
		                  return_money
		          from (select nvl (sum(product_count), 0) product_count,nvl (sum(product_money), 0) product_money from (
		          		select nvl (sum (t1.product_count), 0) product_count,sum (nvl(t1.product_money, 0) + nvl (t.LOGISTICS_MONEY, 0) + nvl (t.DF_MONEY, 0) - nvl(t2.earnest_money, 0)) product_money
                                  from tbl_order_info t,(select order_number,sum(product_count) product_count,sum(product_total_money) product_money
				                    						 from tbl_order_product temp
									                          where exists
										                        (select 1
										                           from tbl_product_info pi
										                          where     exists
										                                       (select 1
										                                          from tbl_dic_product_brand
										                                         where     state = '2'
										                                               and id = pi.brand_id
										                                               <if test="brand_id !=null and brand_id !=0">
													                                     and id = #{brand_id,jdbcType=INTEGER}
													                                   </if>)
										                                and itemnumber = temp.itemnumber)
								                                group by order_number) t1,
								                                tbl_pre_order_relate t2
                                 where     t.create_date >= to_date(#{start_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
		                 			   and t.create_date &lt;= to_date(#{end_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
                                       and t.order_state in (2,3,5)
                                       and t.order_number = t1.order_number(+)
                                       and t.order_number = t2.order_number(+)
					                             <choose>
												 	<when test="site_id !=null and site_id !=0">
												 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = t.user_name)
												 	</when>
												 	<when test="public_user_type != 1">
												 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = t.user_name)
												 	</when>
												 	<otherwise></otherwise>
												 </choose>
						union all
						select nvl (sum (t1.product_count), 0) product_count, nvl(sum(t.earnest_money * t1.rate),0) product_money
  								from tbl_pre_order_info t,(select order_number,sum(product_count) product_count, 
                                    nvl(sum(product_money) / (select nvl(sum(product_money),0) from tbl_pre_order_detail where order_number = temp.order_number and place_state = '1'),0) rate
                                 from tbl_pre_order_detail temp
                                  where place_state = '1'
                                    and exists
                                    (select 1
                                       from tbl_product_info pi
                                      where     exists
                                                   (select 1
                                                      from tbl_dic_product_brand
                                                     where     state = '2'
                                                           and id = pi.brand_id
                                                           <if test="brand_id !=null and brand_id !=0">
						                                     and id = #{brand_id,jdbcType=INTEGER}
						                                   </if>)
                                            and itemnumber = temp.product_itemnumber)
                                    group by order_number) t1
                                 where     t.create_date >= to_date(#{start_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
		                 			   and t.create_date &lt;= to_date(#{end_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
                                       and t.order_state in (2,3)
                                       and t.order_number = t1.order_number(+)
                                       <choose>
												 	<when test="site_id !=null and site_id !=0">
												 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and id = t.user_id)
												 	</when>
												 	<when test="public_user_type != 1">
												 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and id = t.user_id)
												 	</when>
												 	<otherwise></otherwise>
												 </choose>)))
  	</select>
  	
  	
  	<!--**********************************以上代码为品牌折线图统计相关    add for wangpeng 2018-01-15 ************begin*********************** -->
  	<!-- 品牌折线图统计数据-所有支付金额 -->
  	<select id="queryBrandData_AllPayMoney_Chart" parameterType="java.util.Map" resultType="java.util.Map">
  		<if test="brand_id !=null and brand_id !=0">
  			select to_char(PAYMENT_DATE,'yyyy-mm-dd') CREATE_DATE,nvl(sum(PRODUCT_TOTAL_MONEY),0) CNT from TBL_ORDER_PRODUCT a ,TBL_ORDER_INFO b
			where a.order_number = b.order_number and b.PAYMENT_STATE = 2
  		</if>
  		<if test="brand_id ==null or brand_id ==0">
  			select to_char(PAYMENT_DATE,'yyyy-mm-dd') CREATE_DATE,nvl(sum(PRODUCT_money+df_money+LOGISTICS_MONEY),0) CNT from TBL_ORDER_INFO b
			where b.PAYMENT_STATE = 2
  		</if>
		--判断时间筛选
		and b.PAYMENT_DATE >= to_date(#{start_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
		and b.PAYMENT_DATE &lt;= to_date(#{end_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
		<if test="brand_id !=null and brand_id !=0">
			and exists
			(
			   select 1 from tbl_product_info c where a.ITEMNUMBER = c.ITEMNUMBER and c.BRAND_ID =  #{brand_id,jdbcType=INTEGER}
			)
		</if>
		<if test="site_id !=null and site_id !=0">
			and exists
			(
			    select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = b.user_name
			)
		</if>
		<if test="public_user_type != 1">
	 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = b.user_name)
	 	</if>
	 	group by to_char(PAYMENT_DATE,'yyyy-mm-dd')
  	</select>
  	
  	<!-- 品牌折线图统计数据-预订支付的首款 -->
  	<select id="queryBrandData_PreFirstMoney_Chart" parameterType="java.util.Map" resultType="java.util.Map">
  		select to_char(PAYMENT_DATE,'yyyy-mm-dd') CREATE_DATE,nvl(sum(a.PRODUCT_MONEY*(b.EARNEST_MONEY/b.PRODUCT_MONEY)),0) CNT from TBL_PRE_ORDER_DETAIL a ,TBL_PRE_ORDER_INFO b
		where a.order_number = b.order_number and b.PAYMENT_STATE = 2
		--判断时间筛选
		and b.PAYMENT_DATE >= to_date(#{start_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
		and b.PAYMENT_DATE &lt;= to_date(#{end_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
		<if test="brand_id !=null and brand_id !=0">
			and exists
			(
			   select 1 from tbl_product_info c where a.PRODUCT_ITEMNUMBER = c.ITEMNUMBER and c.BRAND_ID =  #{brand_id,jdbcType=INTEGER}
			)
		</if>
		<if test="site_id !=null and site_id !=0">
			and exists
			(
			    select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = a.user_id
			)
		</if>
		<if test="public_user_type != 1">
	 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = a.user_id)
	 	</if>
	 	group by to_char(PAYMENT_DATE,'yyyy-mm-dd')
  	</select>
  	
  	<!-- 品牌折线图统计数据-尾款订单的定金金额 -->
  	<select id="queryBrandData_PreOrderFirstMoney_Chart" parameterType="java.util.Map" resultType="java.util.Map">
  		select to_char(b.PAYMENT_DATE,'yyyy-mm-dd') CREATE_DATE,nvl(sum(a.PRODUCT_TOTAL_MONEY*(g.EARNEST_MONEY/g.PRODUCT_MONEY)),0) CNT from TBL_ORDER_PRODUCT a ,TBL_ORDER_INFO b,TBL_PRE_ORDER_RELATE f,TBL_PRE_ORDER_INFO g
		where a.order_number = f.order_number and f.PRE_ORDER_NUMBER = g.ORDER_NUMBER
		and a.order_number = b.order_number and b.PAYMENT_STATE = 2
		--判断时间筛选
		and b.PAYMENT_DATE >= to_date(#{start_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
		and b.PAYMENT_DATE &lt;= to_date(#{end_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
		<if test="brand_id !=null and brand_id !=0">
			and exists
			(
			   select 1 from tbl_product_info c where a.ITEMNUMBER = c.ITEMNUMBER and c.BRAND_ID =  #{brand_id,jdbcType=INTEGER}
			)
		</if>
		<if test="site_id !=null and site_id !=0">
			and exists
			(
			    select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = a.user_name
			)
		</if>
		<if test="public_user_type != 1">
	 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = a.user_name)
	 	</if>
	 	group by to_char(b.PAYMENT_DATE,'yyyy-mm-dd')
  	</select>
  	
  	<!-- 品牌折线图统计数据-商品访客人数 -->
  	<select id="queryBrandData_VisitorCount_Chart" parameterType="java.util.Map" resultType="java.util.Map">
  		select create_date,count(*) CNT from (
		    select distinct create_user_name,to_char(b.create_date,'yyyy-mm-dd') create_date from tbl_user_log_info b
		    where 
		    --判断时间筛选
		    b.create_date >= to_date(#{start_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
		    and b.create_date &lt;= to_date(#{end_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
		    <if test="brand_id !=null and brand_id !=0">
		    	and page_type = '商品详情'
			    and exists
			    (
			       select 1 from tbl_product_info c where b.PAGE_NAME = c.ITEMNUMBER and c.BRAND_ID =  #{brand_id,jdbcType=INTEGER}
			    )
		    </if>
		    <if test="site_id !=null and site_id !=0">
			    and exists
			    (
			        select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = b.CREATE_USER_NAME
			    )
		    </if>
		    <if test="public_user_type != 1">
		 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = b.CREATE_USER_NAME)
		 	</if>
		)
		group by create_date
  	</select>
  	
  	<!-- 品牌折线图统计数据-购买的人数和总单数 -->
  	<select id="queryBrandData_PurchaseNumberOrderCount_Chart" parameterType="java.util.Map" resultType="java.util.Map">
  		select payment_date create_date,count(*) purchaseNumber,nvl(sum(order_count),0) orderCount  from (
		    select to_char(b.PAYMENT_DATE,'yyyy-mm-dd') payment_date,user_name,count(*) order_count from TBL_ORDER_INFO b
		    where b.PAYMENT_STATE = 2
		    --判断时间筛选
		    and b.PAYMENT_DATE >= to_date(#{start_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
		    and b.PAYMENT_DATE &lt;= to_date(#{end_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
		    <if test="brand_id !=null and brand_id !=0">
			    and exists
			    (
			       select 1 from TBL_ORDER_PRODUCT a,tbl_product_info c where a.ITEMNUMBER = c.ITEMNUMBER and a.order_number = b.order_number and c.BRAND_ID =  #{brand_id,jdbcType=INTEGER}
			    )
		    </if>
		    <if test="site_id !=null and site_id !=0">
		    	and exists
			    (
			        select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = b.user_name
			    )
		    </if>
		    <if test="public_user_type != 1">
		 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = b.user_name)
		 	</if>
		    group by to_char(b.PAYMENT_DATE,'yyyy-mm-dd'),user_name
		) 
		group by payment_date
  	</select>
  	
  	<!-- 品牌折线图统计数据-仅退款金额 -->
  	<select id="queryBrandData_OnlyReturnMoney_Chart" parameterType="java.util.Map" resultType="java.util.Map">
  		select to_char(b.CHECK_DATE,'yyyy-mm-dd') CREATE_DATE,nvl(sum(PRODUCT_TOTAL_MONEY),0) CNT from TBL_ORDER_RETURN_PRODUCT a ,TBL_ORDER_RETURN_INFO b
		where a.RETURN_NUMBER = b.RETURN_NUMBER and b.state = 2
		--判断时间筛选
		and b.CHECK_DATE >= to_date(#{start_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
		and b.CHECK_DATE &lt;= to_date(#{end_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
		<if test="brand_id !=null and brand_id !=0">
			and exists
			(
			   select 1 from tbl_product_info c where a.PRODUCT_ITEMNUMBER = c.ITEMNUMBER and c.BRAND_ID =  #{brand_id,jdbcType=INTEGER}
			)
		</if>
		<if test="site_id !=null and site_id !=0">
			and exists
			(
			    select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = a.user_name
			)
		</if>
		<if test="public_user_type != 1">
	 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = a.user_name)
	 	</if>
	 	group by to_char(b.CHECK_DATE,'yyyy-mm-dd')
  	</select>
  	
  	<!-- 品牌折线图统计数据-售后退款-->
  	<select id="queryBrandData_AfterSaleReturnMoney_Chart" parameterType="java.util.Map" resultType="java.util.Map">
  		select to_char(b.refund_date,'yyyy-mm-dd') CREATE_DATE,nvl(sum(RETURN_MONEY),0) CNT
		from ${jdbc_user}.tbl_new_return_confirm a,${jdbc_user}.tbl_new_return_order b,tbl_product_sku c
		where a.product_sku = c.ID and a.RETURN_NUMBER = b.RETURN_NUMBER and b.state = '8'
		--判断时间筛选
		and b.refund_date >= to_date(#{start_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
		and b.refund_date &lt;= to_date(#{end_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
		<if test="brand_id !=null and brand_id !=0">
			and exists
			(
			   select 1 from tbl_product_info f where c.PRODUCT_ITEMNUMBER = f.ITEMNUMBER and f.BRAND_ID =  #{brand_id,jdbcType=INTEGER}
			)
		</if>
		<if test="site_id !=null and site_id !=0">
			and exists
			(
			    select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = b.user_name
			)
		</if>
		<if test="public_user_type != 1">
	 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = b.user_name)
	 	</if>
	 	group by to_char(b.refund_date,'yyyy-mm-dd')
  	</select>
  	
  	<!-- 品牌折线图统计数据-总成交商品数-->
  	<select id="queryBrandData_SaleCount_Chart" parameterType="java.util.Map" resultType="java.util.Map">
  		select to_char(b.PAYMENT_DATE,'yyyy-mm-dd') CREATE_DATE,nvl(sum(a.product_count),0) CNT from TBL_ORDER_PRODUCT a,TBL_ORDER_INFO b
		where b.PAYMENT_STATE = 2 and a.order_number = b.order_number
		--判断时间筛选
		and b.PAYMENT_DATE >= to_date(#{start_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
		and b.PAYMENT_DATE &lt;= to_date(#{end_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
		<if test="brand_id !=null and brand_id !=0">
			and exists
			(
			   select 1 from tbl_product_info c where a.ITEMNUMBER = c.ITEMNUMBER  and c.BRAND_ID =  #{brand_id,jdbcType=INTEGER}
			)
		</if>
		<if test="site_id !=null and site_id !=0">
			and exists
			(
			    select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = b.user_name
			)
		</if>
		<if test="public_user_type != 1">
	 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = b.user_name)
	 	</if>
	 	group by to_char(b.PAYMENT_DATE,'yyyy-mm-dd')
  	</select>
  	<!--**********************************以上代码为品牌折线图统计相关    add for wangpeng 2018-01-15 ************end*********************** -->
  	
  	
  	<!-- 品牌折线数据    该方法废弃-->
  	<select id="queryBrandDataChart" parameterType="java.util.Map" resultType="java.util.Map">
  		select '支付金额' page_name, nvl(sum(cnt), 0) cnt,create_date from(
			select sum (nvl(t1.product_money, 0)-nvl(t2.earnest_money, 0)) cnt, to_char (t.create_date, 'yyyy-mm-dd') create_date
                    from tbl_order_info t,
                    (select order_number,sum(product_total_money) product_money 
             		   from tbl_order_product temp
                      where exists
                        (select 1
                           from tbl_product_info pi
                          where     exists
                                       (select 1
                                          from tbl_dic_product_brand
                                         where     state = '2'
                                               and id = pi.brand_id
                                               <if test="brand_id !=null and brand_id !=0">
			                                     and id = #{brand_id,jdbcType=INTEGER}
			                                   </if>)
                                and itemnumber = temp.itemnumber)
                              group by order_number) t1,
                              tbl_pre_order_relate t2
                   where     t.create_date >= to_date(#{start_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
		                 and t.create_date &lt;= to_date(#{end_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
                         and t.order_state in (2,3,5)
                         and t.order_number = t1.order_number(+)
                         and t.order_number = t2.order_number(+)
                         <choose>
						 	<when test="site_id !=null and site_id !=0">
						 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = t.user_name)
						 	</when>
						 	<when test="public_user_type != 1">
						 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = t.user_name)
						 	</when>
						 	<otherwise></otherwise>
						 </choose>
        group by to_char (t.create_date, 'yyyy-mm-dd')
        union all
        select nvl(sum(t.earnest_money * t1.rate), 0) cnt, to_char (t.create_date, 'yyyy-mm-dd') create_date
          from tbl_pre_order_info t,
                    (select order_number, nvl(sum(product_money) / (select nvl(sum(product_money),0) from tbl_pre_order_detail where order_number = temp.order_number and place_state = '1'),0) rate
                        from tbl_pre_order_detail temp
                      where place_state = '1'
                        and exists
                        (select 1
                           from tbl_product_info pi
                          where     exists
                                       (select 1
                                          from tbl_dic_product_brand
                                         where     state = '2'
                                               and id = pi.brand_id
                                               <if test="brand_id !=null and brand_id !=0">
			                                     and id = #{brand_id,jdbcType=INTEGER}
			                                   </if>)
                                and itemnumber = temp.product_itemnumber)
                              group by order_number) t1
         			where    t.create_date >= to_date(#{start_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
		                 and t.create_date &lt;= to_date(#{end_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
                         and t.order_state in (2,3)
                         and t.order_number = t1.order_number(+)
                         <choose>
						 	<when test="site_id !=null and site_id !=0">
						 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and id = t.user_id)
						 	</when>
						 	<when test="public_user_type != 1">
						 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and id = t.user_id)
						 	</when>
						 	<otherwise></otherwise>
						 </choose>
						 group by to_char (t.create_date, 'yyyy-mm-dd'))
         group by create_date
		union all
		select '订单笔数' page_name,nvl(sum(cnt), 0) cnt, create_date from (
		select count(t1.order_number) cnt,  to_char (t.create_date, 'yyyy-mm-dd') create_date
          from tbl_order_info t,
          (select order_number
  			 from tbl_order_product temp
            where exists
            (select 1
               from tbl_product_info pi
              where     exists
                           (select 1
                              from tbl_dic_product_brand
                             where     state = '2'
                                   and id = pi.brand_id
                                   <if test="brand_id !=null and brand_id !=0">
                            and id = #{brand_id,jdbcType=INTEGER}
                          </if>)
                    and itemnumber = temp.itemnumber)
                  group by order_number) t1
             where     t.create_date >= to_date(#{start_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
	               and t.create_date &lt;= to_date(#{end_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
                   and t.order_state in (2,3,5)
                   and t.order_number = t1.order_number(+)
                  <choose>
				 	<when test="site_id !=null and site_id !=0">
				 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = t.user_name)
				 	</when>
				 	<when test="public_user_type != 1">
				 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = t.user_name)
				 	</when>
				 	<otherwise></otherwise>
				 </choose>
        group by to_char (t.create_date, 'yyyy-mm-dd')
        union all
        select count(t1.order_number) cnt, to_char (t.create_date, 'yyyy-mm-dd') create_date
          from tbl_pre_order_info t,
                    (select order_number
                        from tbl_pre_order_detail temp
                      where place_state = '1'
                        and exists
                        (select 1
                           from tbl_product_info pi
                          where     exists
                                       (select 1
                                          from tbl_dic_product_brand
                                         where     state = '2'
                                               and id = pi.brand_id
                                               <if test="brand_id !=null and brand_id !=0">
			                                     and id = #{brand_id,jdbcType=INTEGER}
			                                   </if>)
                                and itemnumber = temp.product_itemnumber)
                              group by order_number) t1
         			where    t.create_date >= to_date(#{start_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
		                 and t.create_date &lt;= to_date(#{end_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
                         and t.order_state in (2,3)
                         and t.order_number = t1.order_number(+)
                         <choose>
						 	<when test="site_id !=null and site_id !=0">
						 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and id = t.user_id)
						 	</when>
						 	<when test="public_user_type != 1">
						 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and id = t.user_id)
						 	</when>
						 	<otherwise></otherwise>
						 </choose>
						 group by to_char (t.create_date, 'yyyy-mm-dd'))
			group by create_date
		union all
		select '订单商品数' page_name,nvl(sum(cnt), 0) cnt, create_date from (
	    select nvl (sum (t1.product_count), 0) cnt, to_char (t.create_date, 'yyyy-mm-dd') create_date
                    from tbl_order_info t,
                         (select order_number,sum(product_count) product_count 
                    		from tbl_order_product temp
                           where exists
		                        (select 1
		                           from tbl_product_info pi
		                          where     exists
		                                       (select 1
		                                          from tbl_dic_product_brand
		                                         where     state = '2'
		                                               and id = pi.brand_id
		                                               <if test="brand_id !=null and brand_id !=0">
					                                     and id = #{brand_id,jdbcType=INTEGER}
					                                   </if>)
		                                and itemnumber = temp.itemnumber)
	                               group by order_number) t1
                   where     t.create_date >= to_date(#{start_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
                 		 and t.create_date &lt;= to_date(#{end_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
                         and t.order_state in (2,3,5)
                         and t.order_number = t1.order_number(+)
         		 <choose>
				 	<when test="site_id !=null and site_id !=0">
				 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = t.user_name)
				 	</when>
				 	<when test="public_user_type != 1">
				 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = t.user_name)
				 	</when>
				 	<otherwise></otherwise>
				 </choose>
        group by to_char (t.create_date, 'yyyy-mm-dd')
        union all
        select nvl(sum(t1.product_count), 0) cnt, to_char (t.create_date, 'yyyy-mm-dd') create_date
          from tbl_pre_order_info t,
                    (select order_number, sum(product_count) product_count
                        from tbl_pre_order_detail temp
                      where place_state = '1'
                        and exists
                        (select 1
                           from tbl_product_info pi
                          where     exists
                                       (select 1
                                          from tbl_dic_product_brand
                                         where     state = '2'
                                               and id = pi.brand_id
                                               <if test="brand_id !=null and brand_id !=0">
			                                     and id = #{brand_id,jdbcType=INTEGER}
			                                   </if>)
                                and itemnumber = temp.product_itemnumber)
                              group by order_number) t1
         			where    t.create_date >= to_date(#{start_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
		                 and t.create_date &lt;= to_date(#{end_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
                         and t.order_state in (2,3)
                         and t.order_number = t1.order_number(+)
                         <choose>
						 	<when test="site_id !=null and site_id !=0">
						 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and id = t.user_id)
						 	</when>
						 	<when test="public_user_type != 1">
						 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and id = t.user_id)
						 	</when>
						 	<otherwise></otherwise>
						 </choose>
						 group by to_char (t.create_date, 'yyyy-mm-dd'))
			group by create_date
		union all
		  select '成功退款金额' page_name, sum (return_money) cnt, create_date
		    from (  select sum (temp2.product_money) return_money,
		                   to_char (check_date, 'yyyy-mm-dd') create_date
		              from tbl_order_return_info temp,
		              	   (select return_number,sum(product_total_money) product_money
                                           from tbl_order_return_product t
                                          where exists
                                                   (select 1
                                                      from tbl_product_info pi
                                                     where     exists
                                                                  (select 1
                                                                     from tbl_dic_product_brand
                                                                    where     state = '2'
                                                                          and id = pi.brand_id
                                                                          <if test="brand_id !=null and brand_id !=0">
										                                     and id = #{brand_id,jdbcType=INTEGER}
									                                      </if>)
                                                           and itemnumber = t.product_itemnumber)
                                                           group by return_number) temp2
		             where     temp.state = '2'
		                   and temp.check_date >= to_date(#{start_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
		                   and temp.check_date &lt;= to_date(#{end_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
		                   and temp.return_number = temp2.return_number(+)
	                        <choose>
							 	<when test="site_id !=null and site_id !=0">
							 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = temp.user_name)
							 	</when>
							 	<when test="public_user_type != 1">
							 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = temp.user_name)
							 	</when>
							 	<otherwise></otherwise>
							 </choose>
		          group by to_char (temp.check_date, 'yyyy-mm-dd')
		          union all
		          (  select sum (temp2.return_money) return_money,
		                    to_char (temp.refund_date, 'yyyy-mm-dd') create_date
		               from ${jdbc_user}.tbl_new_return_order temp,
		               		(select return_number, sum (return_money) return_money
							   from ${jdbc_user}.tbl_new_return_confirm t
							  where exists
			                          (select 1
			                             from tbl_product_sku ps
			                            where     exists
			                                         (select 1
			                                            from tbl_product_info pi
		                                               where exists
		                                                        (select 1
		                                                           from tbl_dic_product_brand
		                                                          where     state = '2'
		                                                                and id = pi.brand_id
		                                                                <if test="brand_id !=null and brand_id !=0">
										                                     and id = #{brand_id,jdbcType=INTEGER}
										                                 </if>)
			                                             and itemnumber = ps.product_itemnumber)
			                                  and product_group = '尺码'
			                                  and id = t.product_sku)
					                and return_flag = 1
					                and delete_flag = 0
					          group by return_number) temp2
		              where     temp.state = '8'
		                    and temp.refund_date >= to_date(#{start_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
		                    and temp.refund_date &lt;= to_date(#{end_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
		                    and temp.return_number = temp2.return_number(+)
						    <choose>
							 	<when test="site_id !=null and site_id !=0">
							 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = temp.user_name)
							 	</when>
							 	<when test="public_user_type != 1">
							 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = temp.user_name)
							 	</when>
							 	<otherwise></otherwise>
							 </choose>
		           group by to_char (temp.refund_date, 'yyyy-mm-dd')))
		group by create_date
		union all
		select '支付转化率' page_ame,
		       case
		          when temp3.visitor_order_count = 0
		          then
		             0
		          when temp2.visitor_count = 0
		          then
		             0
		          else
		             round (temp3.visitor_order_count / temp2.visitor_count * 100, 2)
		       end
		          cnt,
		       temp2.create_date
		  from (  select count (distinct create_user_name) visitor_count,
		                 to_char (create_date, 'yyyy-mm-dd') create_date
		            from tbl_user_log_info temp
		           where     create_date >= to_date(#{start_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
		                 and create_date &lt;= to_date(#{end_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
		                 and page_type = '商品详情'
		                 and exists
		                        (select itemnumber
		                           from tbl_product_info pi
		                          where     exists
		                                       (select 1
		                                          from tbl_dic_product_brand
		                                         where     state = '2'
		                                               and id = pi.brand_id
		                                               <if test="brand_id !=null and brand_id !=0">
					                                     and id = #{brand_id,jdbcType=INTEGER}
					                                   </if>)
		                                and itemnumber = temp.page_name)
		                                <choose>
										 	<when test="site_id !=null and site_id !=0">
										 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = temp.create_user_name)
										 	</when>
										 	<when test="public_user_type != 1">
										 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = temp.create_user_name)
										 	</when>
										 	<otherwise></otherwise>
										 </choose>
		        group by to_char (create_date, 'yyyy-mm-dd')) temp2,
		       (  select count (distinct create_user_name) visitor_order_count,
		                 to_char (create_date, 'yyyy-mm-dd') create_date
		            from tbl_user_log_info temp
		           where     create_date >= to_date(#{start_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
		                 and create_date &lt;= to_date(#{end_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
		                 and page_type = '商品详情'
		                 and exists
		                        (select itemnumber
		                           from tbl_product_info pi
		                          where     exists
		                                       (select 1
		                                          from tbl_dic_product_brand
		                                         where     state = '2'
		                                               and id = pi.brand_id
		                                               <if test="brand_id !=null and brand_id !=0">
					                                     and id = #{brand_id,jdbcType=INTEGER}
					                                   </if>)
		                                and itemnumber = temp.page_name)
		                 and not exists
		                            (select user_name
		                               from tbl_order_info
		                              where     create_date >= to_date(#{start_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
		                                    and create_date &lt;= to_date(#{end_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
		                                    and order_state in (2,3,5)
		                                    and user_name = temp.create_user_name)
		                 and not exists
                                    (select user_id
                                       from tbl_pre_order_info 
                                      where  create_date >= to_date(#{start_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
		                                     and create_date &lt;= to_date(#{end_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
                                             and order_state in (2,3)
                                             and user_id = temp.create_user_name)
		                   			 <choose>
									 	<when test="site_id !=null and site_id !=0">
									 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = temp.create_user_name)
									 	</when>
									 	<when test="public_user_type != 1">
									 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = temp.create_user_name)
									 	</when>
									 	<otherwise></otherwise>
									 </choose>
		        group by to_char (create_date, 'yyyy-mm-dd')) temp3
		 where temp2.create_date = temp3.create_date
		union all
		select '客单价' page_name,
		       case
		          when temp3.product_money = 0 then 0
		          when temp2.visitor_count = 0 then 0
		          else round (temp3.product_money / temp2.visitor_count, 2)
		       end
		          cnt,
		       temp2.create_date
		  from (  select count (distinct create_user_name) visitor_count,
		                 to_char (create_date, 'yyyy-mm-dd') create_date
		            from tbl_user_log_info temp
		           where     create_date >= to_date(#{start_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
		                 and create_date &lt;= to_date(#{end_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
		                 and page_type = '商品详情'
		                 and exists
		                        (select itemnumber
		                           from tbl_product_info pi
		                          where     exists
		                                       (select 1
		                                          from tbl_dic_product_brand
		                                         where     state = '2'
		                                               and id = pi.brand_id
		                                               <if test="brand_id !=null and brand_id !=0">
					                                     and id = #{brand_id,jdbcType=INTEGER}
					                                   </if>)
		                                and itemnumber = temp.page_name)
		                			<choose>
									 	<when test="site_id !=null and site_id !=0">
									 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = temp.create_user_name)
									 	</when>
									 	<when test="public_user_type != 1">
									 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = temp.create_user_name)
									 	</when>
									 	<otherwise></otherwise>
									 </choose>
		        group by to_char (create_date, 'yyyy-mm-dd')) temp2,
		       (select sum(product_money) product_money ,create_date from (
		       select sum (nvl(temp.product_total_money, 0)-nvl(temp2.earnest_money, 0)) product_money,
		                 to_char (temp3.create_date, 'yyyy-mm-dd') create_date
		            from tbl_order_product temp,
		                 (select order_number, create_date
		                    from tbl_order_info t
		                   where     create_date >= to_date(#{start_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
		                         and create_date &lt;= to_date(#{end_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
		                         and order_state in (2,3,5)) temp3,
		                         tbl_pre_order_relate temp2
		           where     temp.order_number = temp3.order_number
		                 and temp.order_number = temp2.order_number(+)
		                 and exists
		                        (select itemnumber
		                           from tbl_product_info pi
		                          where     exists
		                                       (select 1
		                                          from tbl_dic_product_brand
		                                         where     state = '2'
		                                               and id = pi.brand_id
		                                               <if test="brand_id !=null and brand_id !=0">
					                                     and id = #{brand_id,jdbcType=INTEGER}
					                                   </if>)
		                                and itemnumber = temp.itemnumber)
		                	<choose>
							 	<when test="site_id !=null and site_id !=0">
							 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = temp.user_name)
							 	</when>
							 	<when test="public_user_type != 1">
							 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = temp.user_name)
							 	</when>
							 	<otherwise></otherwise>
							 </choose>
		        group by to_char (temp3.create_date, 'yyyy-mm-dd')
		    	union all
			  select nvl(sum(t.earnest_money * t1.rate), 0) cnt, to_char (t.create_date, 'yyyy-mm-dd') create_date
	          from tbl_pre_order_info t,
	                    (select order_number, nvl(sum(product_money) / (select nvl(sum(product_money),0) from tbl_pre_order_detail where order_number = temp.order_number and place_state = '1'),0) rate
	                        from tbl_pre_order_detail temp
	                      where place_state = '1'
	                        and exists
	                        (select 1
	                           from tbl_product_info pi
	                          where     exists
	                                       (select 1
	                                          from tbl_dic_product_brand
	                                         where     state = '2'
	                                               and id = pi.brand_id
	                                               <if test="brand_id !=null and brand_id !=0">
				                                     and id = #{brand_id,jdbcType=INTEGER}
				                                   </if>)
	                                and itemnumber = temp.product_itemnumber)
	                              group by order_number) t1
	         			where    t.create_date >= to_date(#{start_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
			                 and t.create_date &lt;= to_date(#{end_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
	                         and t.order_state in (2,3)
	                         and t.order_number = t1.order_number(+)
	                         <choose>
							 	<when test="site_id !=null and site_id !=0">
							 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and id = t.user_id)
							 	</when>
							 	<when test="public_user_type != 1">
							 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and id = t.user_id)
							 	</when>
							 	<otherwise></otherwise>
							 </choose>
							 group by to_char (t.create_date, 'yyyy-mm-dd'))
	         			group by create_date) temp3
		 where temp2.create_date = temp3.create_date
		 union all
		 select '访客数' page_name,
		         count (distinct create_user_name) create_user_name,
		         to_char (create_date, 'yyyy-mm-dd') create_date
		    from tbl_user_log_info temp
		   where     create_date >= to_date(#{start_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
		         and create_date &lt;= to_date(#{end_date,jdbcType=VARCHAR},'yyyy-mm-dd hh24:mi:ss')
		         and page_type = '商品详情'
		         and exists
		                (select itemnumber
		                   from tbl_product_info pi
		                  where     exists
		                               (select 1
		                                  from tbl_dic_product_brand
		                                 where     state = '2'
		                                       and id = pi.brand_id
		                                       <if test="brand_id !=null and brand_id !=0">
			                                     and id = #{brand_id,jdbcType=INTEGER}
			                                   </if>)
		                        and itemnumber = temp.page_name)
		       			<choose>
						 	<when test="site_id !=null and site_id !=0">
						 		and exists (select 1 from tbl_user_info where site_id = #{site_id,jdbcType=INTEGER} and user_name = temp.create_user_name)
						 	</when>
						 	<when test="public_user_type != 1">
						 		and exists (select 1 from tbl_user_info where site_id in (select site_id from tbl_sys_user_site where user_id = #{public_user_id,jdbcType=INTEGER}) and user_name = temp.create_user_name)
						 	</when>
						 	<otherwise></otherwise>
						 </choose>
		group by to_char (create_date, 'yyyy-mm-dd')
  	</select>
  	<!-- 查询页面名称 -->
  	<select id="queryPageNameByPageId" parameterType="string" resultType="string">
  		select nvl((select page_name from tbl_decorate_page where id = #{page_id}),0) page_name from dual
  	</select>
</mapper>